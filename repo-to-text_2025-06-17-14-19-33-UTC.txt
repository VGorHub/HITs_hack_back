Directory: ai-reminder-back

Directory Structure:
```
.
‚îú‚îÄ‚îÄ .gitignore
‚îú‚îÄ‚îÄ .DS_Store
‚îú‚îÄ‚îÄ .dockerignore
‚îú‚îÄ‚îÄ Dockerfile
‚îú‚îÄ‚îÄ README.md
‚îú‚îÄ‚îÄ amplicode.xml
‚îú‚îÄ‚îÄ build.gradle
‚îú‚îÄ‚îÄ docker-compose.yml
‚îÇ¬†¬† ‚îî‚îÄ‚îÄ gradle/wrapper
‚îÇ¬†¬†     ‚îú‚îÄ‚îÄ gradle/wrapper/gradle-wrapper.jar
‚îÇ¬†¬†     ‚îî‚îÄ‚îÄ gradle/wrapper/gradle-wrapper.properties
‚îú‚îÄ‚îÄ gradlew
‚îú‚îÄ‚îÄ gradlew.bat
‚îú‚îÄ‚îÄ keystore.p12
‚îú‚îÄ‚îÄ settings.gradle
‚îî‚îÄ‚îÄ src
    ‚îú‚îÄ‚îÄ src/.DS_Store
    ‚îú‚îÄ‚îÄ src/main
    ‚îÇ¬†¬† ‚îú‚îÄ‚îÄ src/main/.DS_Store
    ‚îÇ¬†¬† ‚îú‚îÄ‚îÄ src/main/java
    ‚îÇ¬†¬† ‚îÇ¬†¬† ‚îú‚îÄ‚îÄ src/main/java/.DS_Store
    ‚îÇ¬†¬† ‚îÇ¬†¬† ‚îî‚îÄ‚îÄ src/main/java/ru
    ‚îÇ¬†¬† ‚îÇ¬†¬†     ‚îú‚îÄ‚îÄ src/main/java/ru/.DS_Store
    ‚îÇ¬†¬† ‚îÇ¬†¬†     ‚îî‚îÄ‚îÄ src/main/java/ru/gigastack
    ‚îÇ¬†¬† ‚îÇ¬†¬†         ‚îú‚îÄ‚îÄ src/main/java/ru/gigastack/.DS_Store
    ‚îÇ¬†¬† ‚îÇ¬†¬†         ‚îî‚îÄ‚îÄ src/main/java/ru/gigastack/ai_reminder_back
    ‚îÇ¬†¬† ‚îÇ¬†¬†             ‚îú‚îÄ‚îÄ src/main/java/ru/gigastack/ai_reminder_back/.DS_Store
    ‚îÇ¬†¬† ‚îÇ¬†¬†             ‚îú‚îÄ‚îÄ src/main/java/ru/gigastack/ai_reminder_back/AiReminderBackApplication.java
    ‚îÇ¬†¬† ‚îÇ¬†¬†             ‚îú‚îÄ‚îÄ src/main/java/ru/gigastack/ai_reminder_back/common
    ‚îÇ¬†¬† ‚îÇ¬†¬†             ‚îÇ¬†¬† ‚îú‚îÄ‚îÄ src/main/java/ru/gigastack/ai_reminder_back/common/ConflictException.java
    ‚îÇ¬†¬† ‚îÇ¬†¬†             ‚îÇ¬†¬† ‚îî‚îÄ‚îÄ src/main/java/ru/gigastack/ai_reminder_back/common/NotFoundException.java
    ‚îÇ¬†¬† ‚îÇ¬†¬†             ‚îú‚îÄ‚îÄ src/main/java/ru/gigastack/ai_reminder_back/config
    ‚îÇ¬†¬† ‚îÇ¬†¬†             ‚îÇ¬†¬† ‚îî‚îÄ‚îÄ src/main/java/ru/gigastack/ai_reminder_back/config/OpenApiConfig.java
    ‚îÇ¬†¬† ‚îÇ¬†¬†             ‚îú‚îÄ‚îÄ src/main/java/ru/gigastack/ai_reminder_back/controllers
    ‚îÇ¬†¬† ‚îÇ¬†¬†             ‚îÇ¬†¬† ‚îî‚îÄ‚îÄ src/main/java/ru/gigastack/ai_reminder_back/controllers/AuthController.java
    ‚îÇ¬†¬† ‚îÇ¬†¬†             ‚îú‚îÄ‚îÄ src/main/java/ru/gigastack/ai_reminder_back/dto
    ‚îÇ¬†¬† ‚îÇ¬†¬†             ‚îÇ¬†¬† ‚îú‚îÄ‚îÄ src/main/java/ru/gigastack/ai_reminder_back/dto/JwtAuthenticationResponse.java
    ‚îÇ¬†¬† ‚îÇ¬†¬†             ‚îÇ¬†¬† ‚îú‚îÄ‚îÄ src/main/java/ru/gigastack/ai_reminder_back/dto/SignInRequest.java
    ‚îÇ¬†¬† ‚îÇ¬†¬†             ‚îÇ¬†¬† ‚îî‚îÄ‚îÄ src/main/java/ru/gigastack/ai_reminder_back/dto/SignUpRequest.java
    ‚îÇ¬†¬† ‚îÇ¬†¬†             ‚îú‚îÄ‚îÄ src/main/java/ru/gigastack/ai_reminder_back/exception
    ‚îÇ¬†¬† ‚îÇ¬†¬†             ‚îÇ¬†¬† ‚îú‚îÄ‚îÄ src/main/java/ru/gigastack/ai_reminder_back/exception/ApiError.java
    ‚îÇ¬†¬† ‚îÇ¬†¬†             ‚îÇ¬†¬† ‚îî‚îÄ‚îÄ src/main/java/ru/gigastack/ai_reminder_back/exception/GlobalExceptionHandler.java
    ‚îÇ¬†¬† ‚îÇ¬†¬†             ‚îú‚îÄ‚îÄ src/main/java/ru/gigastack/ai_reminder_back/models
    ‚îÇ¬†¬† ‚îÇ¬†¬†             ‚îÇ¬†¬† ‚îú‚îÄ‚îÄ src/main/java/ru/gigastack/ai_reminder_back/models/Role.java
    ‚îÇ¬†¬† ‚îÇ¬†¬†             ‚îÇ¬†¬† ‚îî‚îÄ‚îÄ src/main/java/ru/gigastack/ai_reminder_back/models/User.java
    ‚îÇ¬†¬† ‚îÇ¬†¬†             ‚îú‚îÄ‚îÄ src/main/java/ru/gigastack/ai_reminder_back/notification
    ‚îÇ¬†¬† ‚îÇ¬†¬†             ‚îÇ¬†¬† ‚îú‚îÄ‚îÄ src/main/java/ru/gigastack/ai_reminder_back/notification/.DS_Store
    ‚îÇ¬†¬† ‚îÇ¬†¬†             ‚îÇ¬†¬† ‚îú‚îÄ‚îÄ src/main/java/ru/gigastack/ai_reminder_back/notification/channel
    ‚îÇ¬†¬† ‚îÇ¬†¬†             ‚îÇ¬†¬† ‚îÇ¬†¬† ‚îî‚îÄ‚îÄ src/main/java/ru/gigastack/ai_reminder_back/notification/channel/N8nWebhookGateway.java
    ‚îÇ¬†¬† ‚îÇ¬†¬†             ‚îÇ¬†¬† ‚îú‚îÄ‚îÄ src/main/java/ru/gigastack/ai_reminder_back/notification/dto
    ‚îÇ¬†¬† ‚îÇ¬†¬†             ‚îÇ¬†¬† ‚îÇ¬†¬† ‚îî‚îÄ‚îÄ src/main/java/ru/gigastack/ai_reminder_back/notification/dto/ReminderNotification.java
    ‚îÇ¬†¬† ‚îÇ¬†¬†             ‚îÇ¬†¬† ‚îú‚îÄ‚îÄ src/main/java/ru/gigastack/ai_reminder_back/notification/model
    ‚îÇ¬†¬† ‚îÇ¬†¬†             ‚îÇ¬†¬† ‚îÇ¬†¬† ‚îî‚îÄ‚îÄ src/main/java/ru/gigastack/ai_reminder_back/notification/model/OutboxNotification.java
    ‚îÇ¬†¬† ‚îÇ¬†¬†             ‚îÇ¬†¬† ‚îú‚îÄ‚îÄ src/main/java/ru/gigastack/ai_reminder_back/notification/repository
    ‚îÇ¬†¬† ‚îÇ¬†¬†             ‚îÇ¬†¬† ‚îÇ¬†¬† ‚îî‚îÄ‚îÄ src/main/java/ru/gigastack/ai_reminder_back/notification/repository/OutboxRepository.java
    ‚îÇ¬†¬† ‚îÇ¬†¬†             ‚îÇ¬†¬† ‚îî‚îÄ‚îÄ src/main/java/ru/gigastack/ai_reminder_back/notification/service
    ‚îÇ¬†¬† ‚îÇ¬†¬†             ‚îÇ¬†¬†     ‚îú‚îÄ‚îÄ src/main/java/ru/gigastack/ai_reminder_back/notification/service/OutboxNotifier.java
    ‚îÇ¬†¬† ‚îÇ¬†¬†             ‚îÇ¬†¬†     ‚îî‚îÄ‚îÄ src/main/java/ru/gigastack/ai_reminder_back/notification/service/TelegramGateway.java
    ‚îÇ¬†¬† ‚îÇ¬†¬†             ‚îú‚îÄ‚îÄ src/main/java/ru/gigastack/ai_reminder_back/reminder
    ‚îÇ¬†¬† ‚îÇ¬†¬†             ‚îÇ¬†¬† ‚îú‚îÄ‚îÄ src/main/java/ru/gigastack/ai_reminder_back/reminder/.DS_Store
    ‚îÇ¬†¬† ‚îÇ¬†¬†             ‚îÇ¬†¬† ‚îú‚îÄ‚îÄ src/main/java/ru/gigastack/ai_reminder_back/reminder/controller
    ‚îÇ¬†¬† ‚îÇ¬†¬†             ‚îÇ¬†¬† ‚îÇ¬†¬† ‚îî‚îÄ‚îÄ src/main/java/ru/gigastack/ai_reminder_back/reminder/controller/ReminderController.java
    ‚îÇ¬†¬† ‚îÇ¬†¬†             ‚îÇ¬†¬† ‚îú‚îÄ‚îÄ src/main/java/ru/gigastack/ai_reminder_back/reminder/dto
    ‚îÇ¬†¬† ‚îÇ¬†¬†             ‚îÇ¬†¬† ‚îÇ¬†¬† ‚îú‚îÄ‚îÄ src/main/java/ru/gigastack/ai_reminder_back/reminder/dto/ReminderRequest.java
    ‚îÇ¬†¬† ‚îÇ¬†¬†             ‚îÇ¬†¬† ‚îÇ¬†¬† ‚îî‚îÄ‚îÄ src/main/java/ru/gigastack/ai_reminder_back/reminder/dto/ReminderResponse.java
    ‚îÇ¬†¬† ‚îÇ¬†¬†             ‚îÇ¬†¬† ‚îú‚îÄ‚îÄ src/main/java/ru/gigastack/ai_reminder_back/reminder/mapper
    ‚îÇ¬†¬† ‚îÇ¬†¬†             ‚îÇ¬†¬† ‚îÇ¬†¬† ‚îî‚îÄ‚îÄ src/main/java/ru/gigastack/ai_reminder_back/reminder/mapper/ReminderMapper.java
    ‚îÇ¬†¬† ‚îÇ¬†¬†             ‚îÇ¬†¬† ‚îú‚îÄ‚îÄ src/main/java/ru/gigastack/ai_reminder_back/reminder/model
    ‚îÇ¬†¬† ‚îÇ¬†¬†             ‚îÇ¬†¬† ‚îÇ¬†¬† ‚îú‚îÄ‚îÄ src/main/java/ru/gigastack/ai_reminder_back/reminder/model/Reminder.java
    ‚îÇ¬†¬† ‚îÇ¬†¬†             ‚îÇ¬†¬† ‚îÇ¬†¬† ‚îú‚îÄ‚îÄ src/main/java/ru/gigastack/ai_reminder_back/reminder/model/ReminderSource.java
    ‚îÇ¬†¬† ‚îÇ¬†¬†             ‚îÇ¬†¬† ‚îÇ¬†¬† ‚îî‚îÄ‚îÄ src/main/java/ru/gigastack/ai_reminder_back/reminder/model/ReminderState.java
    ‚îÇ¬†¬† ‚îÇ¬†¬†             ‚îÇ¬†¬† ‚îú‚îÄ‚îÄ src/main/java/ru/gigastack/ai_reminder_back/reminder/repository
    ‚îÇ¬†¬† ‚îÇ¬†¬†             ‚îÇ¬†¬† ‚îÇ¬†¬† ‚îî‚îÄ‚îÄ src/main/java/ru/gigastack/ai_reminder_back/reminder/repository/ReminderRepository.java
    ‚îÇ¬†¬† ‚îÇ¬†¬†             ‚îÇ¬†¬† ‚îî‚îÄ‚îÄ src/main/java/ru/gigastack/ai_reminder_back/reminder/service
    ‚îÇ¬†¬† ‚îÇ¬†¬†             ‚îÇ¬†¬†     ‚îú‚îÄ‚îÄ src/main/java/ru/gigastack/ai_reminder_back/reminder/service/ReminderService.java
    ‚îÇ¬†¬† ‚îÇ¬†¬†             ‚îÇ¬†¬†     ‚îî‚îÄ‚îÄ src/main/java/ru/gigastack/ai_reminder_back/reminder/service/ReminderServiceImpl.java
    ‚îÇ¬†¬† ‚îÇ¬†¬†             ‚îú‚îÄ‚îÄ src/main/java/ru/gigastack/ai_reminder_back/repository
    ‚îÇ¬†¬† ‚îÇ¬†¬†             ‚îÇ¬†¬† ‚îî‚îÄ‚îÄ src/main/java/ru/gigastack/ai_reminder_back/repository/UserRepository.java
    ‚îÇ¬†¬† ‚îÇ¬†¬†             ‚îú‚îÄ‚îÄ src/main/java/ru/gigastack/ai_reminder_back/security
    ‚îÇ¬†¬† ‚îÇ¬†¬†             ‚îÇ¬†¬† ‚îú‚îÄ‚îÄ src/main/java/ru/gigastack/ai_reminder_back/security/AuthenticationService.java
    ‚îÇ¬†¬† ‚îÇ¬†¬†             ‚îÇ¬†¬† ‚îú‚îÄ‚îÄ src/main/java/ru/gigastack/ai_reminder_back/security/JsonAuthHandlers.java
    ‚îÇ¬†¬† ‚îÇ¬†¬†             ‚îÇ¬†¬† ‚îú‚îÄ‚îÄ src/main/java/ru/gigastack/ai_reminder_back/security/JwtAuthenticationFilter.java
    ‚îÇ¬†¬† ‚îÇ¬†¬†             ‚îÇ¬†¬† ‚îú‚îÄ‚îÄ src/main/java/ru/gigastack/ai_reminder_back/security/JwtService.java
    ‚îÇ¬†¬† ‚îÇ¬†¬†             ‚îÇ¬†¬† ‚îú‚îÄ‚îÄ src/main/java/ru/gigastack/ai_reminder_back/security/JwtTokenProvider.java
    ‚îÇ¬†¬† ‚îÇ¬†¬†             ‚îÇ¬†¬† ‚îî‚îÄ‚îÄ src/main/java/ru/gigastack/ai_reminder_back/security/SecurityConfiguration.java
    ‚îÇ¬†¬† ‚îÇ¬†¬†             ‚îú‚îÄ‚îÄ src/main/java/ru/gigastack/ai_reminder_back/service
    ‚îÇ¬†¬† ‚îÇ¬†¬†             ‚îÇ¬†¬† ‚îî‚îÄ‚îÄ src/main/java/ru/gigastack/ai_reminder_back/service/UserService.java
    ‚îÇ¬†¬† ‚îÇ¬†¬†             ‚îú‚îÄ‚îÄ src/main/java/ru/gigastack/ai_reminder_back/socketio
    ‚îÇ¬†¬† ‚îÇ¬†¬†             ‚îÇ¬†¬† ‚îú‚îÄ‚îÄ src/main/java/ru/gigastack/ai_reminder_back/socketio/SocketIOConfig.java
    ‚îÇ¬†¬† ‚îÇ¬†¬†             ‚îÇ¬†¬† ‚îú‚îÄ‚îÄ src/main/java/ru/gigastack/ai_reminder_back/socketio/SocketIOGateway.java
    ‚îÇ¬†¬† ‚îÇ¬†¬†             ‚îÇ¬†¬† ‚îî‚îÄ‚îÄ src/main/java/ru/gigastack/ai_reminder_back/socketio/SocketIOListener.java
    ‚îÇ¬†¬† ‚îÇ¬†¬†             ‚îî‚îÄ‚îÄ src/main/java/ru/gigastack/ai_reminder_back/telegram
    ‚îÇ¬†¬† ‚îÇ¬†¬†                 ‚îú‚îÄ‚îÄ src/main/java/ru/gigastack/ai_reminder_back/telegram/ProfileController.java
    ‚îÇ¬†¬† ‚îÇ¬†¬†                 ‚îú‚îÄ‚îÄ src/main/java/ru/gigastack/ai_reminder_back/telegram/TelegramBotHookController.java
    ‚îÇ¬†¬† ‚îÇ¬†¬†                 ‚îú‚îÄ‚îÄ src/main/java/ru/gigastack/ai_reminder_back/telegram/TelegramUserInfoController.java
    ‚îÇ¬†¬† ‚îÇ¬†¬†                 ‚îú‚îÄ‚îÄ src/main/java/ru/gigastack/ai_reminder_back/telegram/dto
    ‚îÇ¬†¬† ‚îÇ¬†¬†                 ‚îÇ¬†¬† ‚îî‚îÄ‚îÄ src/main/java/ru/gigastack/ai_reminder_back/telegram/dto/TelegramChatUpsertRequest.java
    ‚îÇ¬†¬† ‚îÇ¬†¬†                 ‚îú‚îÄ‚îÄ src/main/java/ru/gigastack/ai_reminder_back/telegram/model
    ‚îÇ¬†¬† ‚îÇ¬†¬†                 ‚îÇ¬†¬† ‚îî‚îÄ‚îÄ src/main/java/ru/gigastack/ai_reminder_back/telegram/model/TelegramChat.java
    ‚îÇ¬†¬† ‚îÇ¬†¬†                 ‚îî‚îÄ‚îÄ src/main/java/ru/gigastack/ai_reminder_back/telegram/repository
    ‚îÇ¬†¬† ‚îÇ¬†¬†                     ‚îî‚îÄ‚îÄ src/main/java/ru/gigastack/ai_reminder_back/telegram/repository/TelegramChatRepository.java
    ‚îÇ¬†¬† ‚îî‚îÄ‚îÄ src/main/resources
    ‚îÇ¬†¬†     ‚îú‚îÄ‚îÄ src/main/resources/application.properties
    ‚îÇ¬†¬†     ‚îú‚îÄ‚îÄ src/main/resources/application.yml
    ‚îÇ¬†¬†     ‚îÇ¬†¬† ‚îî‚îÄ‚îÄ src/main/resources/db/migration
    ‚îÇ¬†¬†     ‚îÇ¬†¬†     ‚îî‚îÄ‚îÄ src/main/resources/db/migration/V1__init.sql
    ‚îÇ¬†¬†     ‚îî‚îÄ‚îÄ src/main/resources/keystore.p12
                    ‚îî‚îÄ‚îÄ src/test/java/ru/gigastack/ai_reminder_back
                        ‚îî‚îÄ‚îÄ src/test/java/ru/gigastack/ai_reminder_back/AiReminderBackApplicationTests.java
```

Contents of .DS_Store:
```
[Could not decode file contents]

```

Contents of Dockerfile:
```
# Dockerfile ‚Äî –º–Ω–æ–≥–æ—Å—Ç—É–ø–µ–Ω—á–∞—Ç–∞—è —Å–±–æ—Ä–∫–∞ –∏ –∑–∞–ø—É—Å–∫
# –≠—Ç–∞–ø —Å–±–æ—Ä–∫–∏
FROM gradle:8.7-jdk21 AS builder
WORKDIR /workspace
COPY . .
RUN gradle bootJar -x test                                      # —Å–æ–±–∏—Ä–∞–µ–º fat-jar  [oai_citation:0‚Ä°repo-to-text_2025-06-17-10-58-13-UTC.txt](file-service://file-LLWE4NGxgw6FUcSh4iaPJs)

# –≠—Ç–∞–ø –∑–∞–ø—É—Å–∫–∞
FROM eclipse-temurin:21-jre-alpine
WORKDIR /app

# –¢–æ–ª—å–∫–æ jar: keystore –º–æ–Ω—Ç–∏—Ä—É–µ–º —á–µ—Ä–µ–∑ docker-compose
COPY --from=builder /workspace/build/libs/*.jar app.jar

# JVM-–æ–ø—Ü–∏–∏: 8443 –ø–æ—Ä—Ç –∏ prod‚Äì–ø—Ä–æ—Ñ–∏–ª—å
ENV JAVA_TOOL_OPTIONS="\
 -Dserver.port=8443 \
 -Dspring.profiles.active=prod"

EXPOSE 8443
EXPOSE 9092
ENTRYPOINT ["java", "-jar", "/app/app.jar"]
```

Contents of keystore.p12:
```
[Could not decode file contents]

```

Contents of README.md:
```
# HITs_hack_back

```

Contents of gradlew:
```
#!/bin/sh

#
# Copyright ¬© 2015-2021 the original authors.
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#      https://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.
#
# SPDX-License-Identifier: Apache-2.0
#

##############################################################################
#
#   Gradle start up script for POSIX generated by Gradle.
#
#   Important for running:
#
#   (1) You need a POSIX-compliant shell to run this script. If your /bin/sh is
#       noncompliant, but you have some other compliant shell such as ksh or
#       bash, then to run this script, type that shell name before the whole
#       command line, like:
#
#           ksh Gradle
#
#       Busybox and similar reduced shells will NOT work, because this script
#       requires all of these POSIX shell features:
#         * functions;
#         * expansions ¬´$var¬ª, ¬´${var}¬ª, ¬´${var:-default}¬ª, ¬´${var+SET}¬ª,
#           ¬´${var#prefix}¬ª, ¬´${var%suffix}¬ª, and ¬´$( cmd )¬ª;
#         * compound commands having a testable exit status, especially ¬´case¬ª;
#         * various built-in commands including ¬´command¬ª, ¬´set¬ª, and ¬´ulimit¬ª.
#
#   Important for patching:
#
#   (2) This script targets any POSIX shell, so it avoids extensions provided
#       by Bash, Ksh, etc; in particular arrays are avoided.
#
#       The "traditional" practice of packing multiple parameters into a
#       space-separated string is a well documented source of bugs and security
#       problems, so this is (mostly) avoided, by progressively accumulating
#       options in "$@", and eventually passing that to Java.
#
#       Where the inherited environment variables (DEFAULT_JVM_OPTS, JAVA_OPTS,
#       and GRADLE_OPTS) rely on word-splitting, this is performed explicitly;
#       see the in-line comments for details.
#
#       There are tweaks for specific operating systems such as AIX, CygWin,
#       Darwin, MinGW, and NonStop.
#
#   (3) This script is generated from the Groovy template
#       https://github.com/gradle/gradle/blob/HEAD/platforms/jvm/plugins-application/src/main/resources/org/gradle/api/internal/plugins/unixStartScript.txt
#       within the Gradle project.
#
#       You can find Gradle at https://github.com/gradle/gradle/.
#
##############################################################################

# Attempt to set APP_HOME

# Resolve links: $0 may be a link
app_path=$0

# Need this for daisy-chained symlinks.
while
    APP_HOME=${app_path%"${app_path##*/}"}  # leaves a trailing /; empty if no leading path
    [ -h "$app_path" ]
do
    ls=$( ls -ld "$app_path" )
    link=${ls#*' -> '}
    case $link in             #(
      /*)   app_path=$link ;; #(
      *)    app_path=$APP_HOME$link ;;
    esac
done

# This is normally unused
# shellcheck disable=SC2034
APP_BASE_NAME=${0##*/}
# Discard cd standard output in case $CDPATH is set (https://github.com/gradle/gradle/issues/25036)
APP_HOME=$( cd -P "${APP_HOME:-./}" > /dev/null && printf '%s\n' "$PWD" ) || exit

# Use the maximum available, or set MAX_FD != -1 to use that value.
MAX_FD=maximum

warn () {
    echo "$*"
} >&2

die () {
    echo
    echo "$*"
    echo
    exit 1
} >&2

# OS specific support (must be 'true' or 'false').
cygwin=false
msys=false
darwin=false
nonstop=false
case "$( uname )" in                #(
  CYGWIN* )         cygwin=true  ;; #(
  Darwin* )         darwin=true  ;; #(
  MSYS* | MINGW* )  msys=true    ;; #(
  NONSTOP* )        nonstop=true ;;
esac

CLASSPATH="\\\"\\\""


# Determine the Java command to use to start the JVM.
if [ -n "$JAVA_HOME" ] ; then
    if [ -x "$JAVA_HOME/jre/sh/java" ] ; then
        # IBM's JDK on AIX uses strange locations for the executables
        JAVACMD=$JAVA_HOME/jre/sh/java
    else
        JAVACMD=$JAVA_HOME/bin/java
    fi
    if [ ! -x "$JAVACMD" ] ; then
        die "ERROR: JAVA_HOME is set to an invalid directory: $JAVA_HOME

Please set the JAVA_HOME variable in your environment to match the
location of your Java installation."
    fi
else
    JAVACMD=java
    if ! command -v java >/dev/null 2>&1
    then
        die "ERROR: JAVA_HOME is not set and no 'java' command could be found in your PATH.

Please set the JAVA_HOME variable in your environment to match the
location of your Java installation."
    fi
fi

# Increase the maximum file descriptors if we can.
if ! "$cygwin" && ! "$darwin" && ! "$nonstop" ; then
    case $MAX_FD in #(
      max*)
        # In POSIX sh, ulimit -H is undefined. That's why the result is checked to see if it worked.
        # shellcheck disable=SC2039,SC3045
        MAX_FD=$( ulimit -H -n ) ||
            warn "Could not query maximum file descriptor limit"
    esac
    case $MAX_FD in  #(
      '' | soft) :;; #(
      *)
        # In POSIX sh, ulimit -n is undefined. That's why the result is checked to see if it worked.
        # shellcheck disable=SC2039,SC3045
        ulimit -n "$MAX_FD" ||
            warn "Could not set maximum file descriptor limit to $MAX_FD"
    esac
fi

# Collect all arguments for the java command, stacking in reverse order:
#   * args from the command line
#   * the main class name
#   * -classpath
#   * -D...appname settings
#   * --module-path (only if needed)
#   * DEFAULT_JVM_OPTS, JAVA_OPTS, and GRADLE_OPTS environment variables.

# For Cygwin or MSYS, switch paths to Windows format before running java
if "$cygwin" || "$msys" ; then
    APP_HOME=$( cygpath --path --mixed "$APP_HOME" )
    CLASSPATH=$( cygpath --path --mixed "$CLASSPATH" )

    JAVACMD=$( cygpath --unix "$JAVACMD" )

    # Now convert the arguments - kludge to limit ourselves to /bin/sh
    for arg do
        if
            case $arg in                                #(
              -*)   false ;;                            # don't mess with options #(
              /?*)  t=${arg#/} t=/${t%%/*}              # looks like a POSIX filepath
                    [ -e "$t" ] ;;                      #(
              *)    false ;;
            esac
        then
            arg=$( cygpath --path --ignore --mixed "$arg" )
        fi
        # Roll the args list around exactly as many times as the number of
        # args, so each arg winds up back in the position where it started, but
        # possibly modified.
        #
        # NB: a `for` loop captures its iteration list before it begins, so
        # changing the positional parameters here affects neither the number of
        # iterations, nor the values presented in `arg`.
        shift                   # remove old arg
        set -- "$@" "$arg"      # push replacement arg
    done
fi


# Add default JVM options here. You can also use JAVA_OPTS and GRADLE_OPTS to pass JVM options to this script.
DEFAULT_JVM_OPTS='"-Xmx64m" "-Xms64m"'

# Collect all arguments for the java command:
#   * DEFAULT_JVM_OPTS, JAVA_OPTS, and optsEnvironmentVar are not allowed to contain shell fragments,
#     and any embedded shellness will be escaped.
#   * For example: A user cannot expect ${Hostname} to be expanded, as it is an environment variable and will be
#     treated as '${Hostname}' itself on the command line.

set -- \
        "-Dorg.gradle.appname=$APP_BASE_NAME" \
        -classpath "$CLASSPATH" \
        -jar "$APP_HOME/gradle/wrapper/gradle-wrapper.jar" \
        "$@"

# Stop when "xargs" is not available.
if ! command -v xargs >/dev/null 2>&1
then
    die "xargs is not available"
fi

# Use "xargs" to parse quoted args.
#
# With -n1 it outputs one arg per line, with the quotes and backslashes removed.
#
# In Bash we could simply go:
#
#   readarray ARGS < <( xargs -n1 <<<"$var" ) &&
#   set -- "${ARGS[@]}" "$@"
#
# but POSIX shell has neither arrays nor command substitution, so instead we
# post-process each arg (as a line of input to sed) to backslash-escape any
# character that might be a shell metacharacter, then use eval to reverse
# that process (while maintaining the separation between arguments), and wrap
# the whole thing up as a single "set" statement.
#
# This will of course break if any of these variables contains a newline or
# an unmatched quote.
#

eval "set -- $(
        printf '%s\n' "$DEFAULT_JVM_OPTS $JAVA_OPTS $GRADLE_OPTS" |
        xargs -n1 |
        sed ' s~[^-[:alnum:]+,./:=@_]~\\&~g; ' |
        tr '\n' ' '
    )" '"$@"'

exec "$JAVACMD" "$@"

```

Contents of .dockerignore:
```
.git
.gradle
build
out
**/.DS_Store
```

Contents of build.gradle:
```
plugins {
	id 'java'
	id 'org.springframework.boot' version '3.5.0'
	id 'io.spring.dependency-management' version '1.1.7'
	id 'org.asciidoctor.jvm.convert' version '3.3.2'
	id 'org.liquibase.gradle'       version '2.2.1'
}

group   = 'ru.gigastack'
version = '0.0.1-SNAPSHOT'

java { toolchain { languageVersion = JavaLanguageVersion.of(21) } }

repositories { mavenCentral() }

ext { set('snippetsDir', file("build/generated-snippets")) }

dependencies {
	implementation 'org.springframework.boot:spring-boot-starter-actuator'
	implementation 'org.springframework.boot:spring-boot-starter-data-jpa'
	implementation 'org.springframework.boot:spring-boot-starter-quartz'
	implementation 'org.springframework.boot:spring-boot-starter-security'
	implementation 'org.springframework.boot:spring-boot-starter-validation'
	implementation 'org.springframework.boot:spring-boot-starter-web'
	implementation 'org.springframework.boot:spring-boot-starter-webflux'

	/* --- WebSocket / Socket.IO --- */
	implementation 'com.corundumstudio.socketio:netty-socketio:1.7.19'

	implementation 'org.flywaydb:flyway-core'
	implementation 'org.flywaydb:flyway-database-postgresql'
	runtimeOnly   'org.postgresql:postgresql'

	testImplementation 'org.springframework.boot:spring-boot-starter-test'
	testImplementation 'io.projectreactor:reactor-test'
	testImplementation 'org.springframework.restdocs:spring-restdocs-mockmvc'
	testImplementation 'org.springframework.security:spring-security-test'
	testRuntimeOnly   'org.junit.platform:junit-platform-launcher'

	implementation 'io.jsonwebtoken:jjwt-api:0.12.3'
	runtimeOnly   'io.jsonwebtoken:jjwt-impl:0.12.3'
	runtimeOnly   'io.jsonwebtoken:jjwt-jackson:0.12.3'

	implementation('org.springdoc:springdoc-openapi-starter-webmvc-ui:2.8.9')
	implementation("org.projectlombok:lombok:1.18.30")
	compileOnly    'org.projectlombok:lombok:1.18.30'
	annotationProcessor 'org.projectlombok:lombok:1.18.30'

	implementation 'org.mapstruct:mapstruct:1.5.5.Final'
	annotationProcessor 'org.mapstruct:mapstruct-processor:1.5.5.Final'

	implementation 'com.fasterxml.jackson.datatype:jackson-datatype-jsr310'

	implementation 'com.corundumstudio.socketio:netty-socketio:1.7.19'
}

tasks.named('test')       { outputs.dir snippetsDir; useJUnitPlatform() }
tasks.named('asciidoctor'){ inputs.dir  snippetsDir; dependsOn test      }

liquibase {
	activities.register("main") {
		url  = "jdbc:postgresql://localhost:5432/ai_reminder"
		username = "postgres"
		password = "postgres"
		driver   = "org.postgresql.Driver"
		referenceUrl =
				"hibernate:spring:ru.gigastack.ai_reminder_back?dialect=org.hibernate.dialect.PostgreSQLDialect"
	}
}
```

Contents of docker-compose.yml:
```
# docker-compose.yml
version: "3.9"

services:
  db:
    image: postgres:16-alpine
    container_name: reminder_postgres
    restart: unless-stopped
    environment:
      POSTGRES_DB: ai_reminder
      POSTGRES_USER: postgres
      POSTGRES_PASSWORD: postgres
    ports:
      - "5432:5432"
    volumes:
      - pgdata:/var/lib/postgresql/data
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -U postgres"]
      interval: 10s
      timeout: 5s
      retries: 5

  backend:
    build:
      context: .
    container_name: ai-reminder-back
    depends_on:
      db:
        condition: service_healthy
    ports:
      - "8443:8443"
      - "9092:9092"
    environment:
      # –ü–æ–¥—Ç—è–≥–∏–≤–∞–µ–º vars –≤–º–µ—Å—Ç–æ ¬´–∂—ë—Å—Ç–∫–∏—Ö¬ª –∑–Ω–∞—á–µ–Ω–∏–π
      SPRING_DATASOURCE_URL: jdbc:postgresql://db:5432/ai_reminder
      SPRING_DATASOURCE_USERNAME: postgres
      SPRING_DATASOURCE_PASSWORD: postgres
      N8N_WEBHOOK_URL: https://n8n.gigafs.v6.navy/webhook/webhook/ai-reminder
      TOKEN_SIGNING_KEY: 53A73E5F1C4E0A2D3B5F2D784E6A1B423D6F247D1F6E5C3A596D635A75327855
      KEY_STORE_PASSWORD: changeit
    volumes:
      - ./keystore.p12:/app/keystore.p12:ro

volumes:
  pgdata:
```

Contents of gradlew.bat:
```
@rem
@rem Copyright 2015 the original author or authors.
@rem
@rem Licensed under the Apache License, Version 2.0 (the "License");
@rem you may not use this file except in compliance with the License.
@rem You may obtain a copy of the License at
@rem
@rem      https://www.apache.org/licenses/LICENSE-2.0
@rem
@rem Unless required by applicable law or agreed to in writing, software
@rem distributed under the License is distributed on an "AS IS" BASIS,
@rem WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
@rem See the License for the specific language governing permissions and
@rem limitations under the License.
@rem
@rem SPDX-License-Identifier: Apache-2.0
@rem

@if "%DEBUG%"=="" @echo off
@rem ##########################################################################
@rem
@rem  Gradle startup script for Windows
@rem
@rem ##########################################################################

@rem Set local scope for the variables with windows NT shell
if "%OS%"=="Windows_NT" setlocal

set DIRNAME=%~dp0
if "%DIRNAME%"=="" set DIRNAME=.
@rem This is normally unused
set APP_BASE_NAME=%~n0
set APP_HOME=%DIRNAME%

@rem Resolve any "." and ".." in APP_HOME to make it shorter.
for %%i in ("%APP_HOME%") do set APP_HOME=%%~fi

@rem Add default JVM options here. You can also use JAVA_OPTS and GRADLE_OPTS to pass JVM options to this script.
set DEFAULT_JVM_OPTS="-Xmx64m" "-Xms64m"

@rem Find java.exe
if defined JAVA_HOME goto findJavaFromJavaHome

set JAVA_EXE=java.exe
%JAVA_EXE% -version >NUL 2>&1
if %ERRORLEVEL% equ 0 goto execute

echo. 1>&2
echo ERROR: JAVA_HOME is not set and no 'java' command could be found in your PATH. 1>&2
echo. 1>&2
echo Please set the JAVA_HOME variable in your environment to match the 1>&2
echo location of your Java installation. 1>&2

goto fail

:findJavaFromJavaHome
set JAVA_HOME=%JAVA_HOME:"=%
set JAVA_EXE=%JAVA_HOME%/bin/java.exe

if exist "%JAVA_EXE%" goto execute

echo. 1>&2
echo ERROR: JAVA_HOME is set to an invalid directory: %JAVA_HOME% 1>&2
echo. 1>&2
echo Please set the JAVA_HOME variable in your environment to match the 1>&2
echo location of your Java installation. 1>&2

goto fail

:execute
@rem Setup the command line

set CLASSPATH=


@rem Execute Gradle
"%JAVA_EXE%" %DEFAULT_JVM_OPTS% %JAVA_OPTS% %GRADLE_OPTS% "-Dorg.gradle.appname=%APP_BASE_NAME%" -classpath "%CLASSPATH%" -jar "%APP_HOME%\gradle\wrapper\gradle-wrapper.jar" %*

:end
@rem End local scope for the variables with windows NT shell
if %ERRORLEVEL% equ 0 goto mainEnd

:fail
rem Set variable GRADLE_EXIT_CONSOLE if you need the _script_ return code instead of
rem the _cmd.exe /c_ return code!
set EXIT_CODE=%ERRORLEVEL%
if %EXIT_CODE% equ 0 set EXIT_CODE=1
if not ""=="%GRADLE_EXIT_CONSOLE%" exit %EXIT_CODE%
exit /b %EXIT_CODE%

:mainEnd
if "%OS%"=="Windows_NT" endlocal

:omega

```

Contents of settings.gradle:
```
rootProject.name = 'ai-reminder-back'

```

Contents of amplicode.xml:
```
<?xml version="1.0" encoding="UTF-8"?>
<project version="4">
  <component name="AmplicodeDatabaseMigrationSettings" lastSelectedDirectory="src/main/resources/db/migration" />
  <component name="AmplicodePersistenceUnitSettings">
    <persistence-units>
      <persistence-unit moduleName="ai-reminder-back.main" name="Default">
        <packages>
          <package value="ru.gigastack.ai_reminder_back" />
        </packages>
      </persistence-unit>
    </persistence-units>
  </component>
</project>
```

Contents of gradle/wrapper/gradle-wrapper.jar:
```
[Could not decode file contents]

```

Contents of gradle/wrapper/gradle-wrapper.properties:
```
distributionBase=GRADLE_USER_HOME
distributionPath=wrapper/dists
distributionUrl=https\://services.gradle.org/distributions/gradle-8.14.2-bin.zip
networkTimeout=10000
validateDistributionUrl=true
zipStoreBase=GRADLE_USER_HOME
zipStorePath=wrapper/dists

```

Contents of src/.DS_Store:
```
[Could not decode file contents]

```

Contents of src/test/java/ru/gigastack/ai_reminder_back/AiReminderBackApplicationTests.java:
```
package ru.gigastack.ai_reminder_back;

import org.junit.jupiter.api.Test;
import org.springframework.boot.test.context.SpringBootTest;

/*@SpringBootTest
class AiReminderBackApplicationTests {

	@Test
	void contextLoads() {
	}

}*/

```

Contents of src/main/.DS_Store:
```
[Could not decode file contents]

```

Contents of src/main/resources/keystore.p12:
```
[Could not decode file contents]

```

Contents of src/main/resources/application.yml:
```
###############################################################################
# üìö Application configuration for **ai‚Äëreminder‚Äëback**
# ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
# –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–∞:
#   ‚ûä COMMON ‚Äì –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –≤–æ –≤—Å–µ—Ö –ø—Ä–æ—Ñ–∏–ª—è—Ö.
#   ‚ûã PROD   ‚Äì –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã / k8s / staging / production.
#   ‚ûå LOCAL  ‚Äì —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞ –Ω–∞ –Ω–æ—É—Ç–±—É–∫–µ.
#
# ‚Üí –í—Å–µ –∑–Ω–∞—á–µ–Ω–∏—è –º–æ–∂–Ω–æ –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏ –æ–∫—Ä—É–∂–µ–Ω–∏—è
#   –≤–∏–¥–∞  ENV_NAME  ‚Äî>  spring.property.name
#
#   –ù–∞–ø—Ä–∏–º–µ—Ä:
#     N8N_WEBHOOK_URL   ‚Üí  n8n.webhook.url
#     SERVER_PORT       ‚Üí  server.port
#
# ‚Üí –ó–∞–ø—É—Å–∫
#     # –ª–æ–∫–∞–ª—å–Ω–æ
#     SPRING_PROFILES_ACTIVE=local ./gradlew bootRun
#
#     # docker‚Äëcompose (prod‚Äëprofile)
#     docker compose up -d   # .env –≤—ã—Å—Ç–∞–≤–ª—è–µ—Ç PROD‚Äë–ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
###############################################################################

###############################################################################
# ‚ûä COMMON (—Ä–∞–±–æ—Ç–∞–µ—Ç –≤–æ –≤—Å–µ—Ö –ø—Ä–æ—Ñ–∏–ª—è—Ö)
###############################################################################

spring:
  application:
    name: ai-reminder

  datasource:
    url:      ${SPRING_DATASOURCE_URL:jdbc:postgresql://localhost:5432/ai_reminder}
    username: ${SPRING_DATASOURCE_USERNAME:postgres}
    password: ${SPRING_DATASOURCE_PASSWORD:postgres}
    hikari:
      maximum-pool-size: ${SPRING_DATASOURCE_MAX_POOL_SIZE:10}

  jpa:
    hibernate:
      ddl-auto: validate          # Flyway —Ä—É–ª–∏—Ç —Å—Ö–µ–º–æ–π, –Ω–µ –¥–∞—ë–º Hibernate –º–µ–Ω—è—Ç—å –µ—ë
    open-in-view: false
  flyway:
    enabled: true

server:
  port: ${SERVER_PORT:8443}        # –º–æ–∂–µ—Ç –±—ã—Ç—å –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª—ë–Ω –≤ –ø—Ä–æ—Ñ–∏–ª—è—Ö
  shutdown: graceful

logging:
  level:
    root: INFO

# JWT / access‚Äëtokens
token:
  signing:
    key: ${TOKEN_SIGNING_KEY:53A73E5F1C4E0A2D3B5F2D784E6A1B423D6F247D1F6E5C3A596D635A75327855}

# >>> WebSocket / Socket.IO
socketio:
  port: ${SOCKETIO_PORT:9092}

n8n:
  webhook:
    url: ${N8N_WEBHOOK_URL:https://n8n.gigafs.v6.navy/webhook-test/webhook/ai-reminder}



###############################################################################
# ‚ûã PROD profile  ‚Üí  SPRING_PROFILES_ACTIVE=prod
###############################################################################
---
spring:
  config:
    activate:
      on-profile: prod

# –í –ø—Ä–æ–¥–µ –ø–æ—Ä—Ç —á–∞—â–µ –∑–∞–¥–∞—ë—Ç—Å—è —á–µ—Ä–µ–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é SERVER_PORT –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ
server:
  port: ${SERVER_PORT:8443}
  ssl:
    enabled: true
    key-store: file:/app/keystore.p12      # –ø—É—Ç—å –≤–Ω—É—Ç—Ä–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
    key-store-password: ${KEY_STORE_PASSWORD}
    key-store-type: PKCS12
    key-alias: ai-reminder

logging:
  level:
    root: INFO
    org.springframework.web: WARN

###############################################################################
# ‚ûå LOCAL profile ‚Üí  SPRING_PROFILES_ACTIVE=local
###############################################################################
---
spring:
  config:
    activate:
      on-profile: local

server:
  port: 8443
  ssl:
    enabled: true
    key-store: classpath:keystore.p12        # –ø–æ–ª–æ–∂–∏ —Ñ–∞–π–ª –≤ src/main/resources
    key-store-password: changeit             # –∏–ª–∏ —Å–≤–æ–π –ø–∞—Ä–æ–ª—å
    key-store-type: PKCS12
    key-alias: ai-reminder

# –±–æ–ª–µ–µ –ø–æ–¥—Ä–æ–±–Ω—ã–µ –ª–æ–≥–∏ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
logging:
  level:
    ru.gigastack.ai_reminder_back: DEBUG
    root: INFO
    org.springframework.web: DEBUG

```

Contents of src/main/resources/application.properties:
```
spring.application.name=ai-reminder-back
#Flyway configuration
spring.flyway.baseline-on-migrate=true
spring.flyway.baseline-version=0

```

Contents of src/main/resources/db/migration/V1__init.sql:
```
-- V1__init.sql  (–±–µ–∑ –∏—Å—Ç–æ—Ä–∏–∏ Flyway)

-------------------------------------------------------------------------------
-- 1. –°–µ–∫–≤–µ–Ω—Å –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
-------------------------------------------------------------------------------
CREATE SEQUENCE IF NOT EXISTS user_id_seq
  AS BIGINT
  START WITH 1
  INCREMENT BY 1
  MINVALUE 1
  MAXVALUE 9223372036854775807
  CACHE 1;

-------------------------------------------------------------------------------
-- 2. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
-------------------------------------------------------------------------------
CREATE TABLE users (
  id        BIGINT NOT NULL DEFAULT nextval('user_id_seq'),
  username  VARCHAR(255) NOT NULL,
  password  VARCHAR(255) NOT NULL,
  role      VARCHAR(255) NOT NULL,
  tg_id     VARCHAR(255),
  CONSTRAINT users_pkey        PRIMARY KEY (id),
  CONSTRAINT uk_users_username UNIQUE (username),
  CONSTRAINT uk_users_tg_id    UNIQUE (tg_id)
);

-------------------------------------------------------------------------------
-- 3. Outbox –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
-------------------------------------------------------------------------------
CREATE TABLE outbox_notifications (
  id         BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  reminder_id BIGINT,
  user_id     BIGINT,
  payload     TEXT,
  processed   BOOLEAN NOT NULL,
  created_at  TIMESTAMP WITH TIME ZONE
);

-------------------------------------------------------------------------------
-- 4. –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è
-------------------------------------------------------------------------------
CREATE TABLE reminders (
  id        BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  user_id   BIGINT,
  title     VARCHAR(255),
  description VARCHAR(2000),
  scheduled_at TIMESTAMP WITH TIME ZONE,
  location  VARCHAR(255),
  state     VARCHAR(255),
  source    VARCHAR(255),
  external_calendar_event_id VARCHAR(255),
  created_at TIMESTAMP WITH TIME ZONE
);

-------------------------------------------------------------------------------
-- 5. Telegram-—á–∞—Ç—ã
-------------------------------------------------------------------------------
CREATE TABLE telegram_chats (
  tg_id   VARCHAR(255) PRIMARY KEY,
  chat_id BIGINT NOT NULL
);
```

Contents of src/main/java/.DS_Store:
```
[Could not decode file contents]

```

Contents of src/main/java/ru/.DS_Store:
```
[Could not decode file contents]

```

Contents of src/main/java/ru/gigastack/.DS_Store:
```
[Could not decode file contents]

```

Contents of src/main/java/ru/gigastack/ai_reminder_back/.DS_Store:
```
[Could not decode file contents]

```

Contents of src/main/java/ru/gigastack/ai_reminder_back/AiReminderBackApplication.java:
```
package ru.gigastack.ai_reminder_back;

import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;
import org.springframework.scheduling.annotation.EnableScheduling;

@SpringBootApplication
@EnableScheduling
public class AiReminderBackApplication {

	public static void main(String[] args) {
		SpringApplication.run(AiReminderBackApplication.class, args);
	}

}

```

Contents of src/main/java/ru/gigastack/ai_reminder_back/dto/SignInRequest.java:
```
package ru.gigastack.ai_reminder_back.dto;

import io.swagger.v3.oas.annotations.media.Schema;
import jakarta.validation.constraints.NotBlank;
import jakarta.validation.constraints.Size;
import lombok.Data;

@Data
@Schema(description = "–ó–∞–ø—Ä–æ—Å –Ω–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é")
public class SignInRequest {

    @Schema(description = "–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è", example = "Jon")
    @Size(min = 5, max = 50, message = "–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–æ–ª–∂–Ω–æ —Å–æ–¥–µ—Ä–∂–∞—Ç—å –æ—Ç 5 –¥–æ 50 —Å–∏–º–≤–æ–ª–æ–≤")
    @NotBlank(message = "–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—É—Å—Ç—ã–º–∏")
    private String username;

    @Schema(description = "–ü–∞—Ä–æ–ª—å", example = "my_1secret1_password")
    @Size(min = 8, max = 255, message = "–î–ª–∏–Ω–∞ –ø–∞—Ä–æ–ª—è –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –æ—Ç 8 –¥–æ 255 —Å–∏–º–≤–æ–ª–æ–≤")
    @NotBlank(message = "–ü–∞—Ä–æ–ª—å –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—É—Å—Ç—ã–º–∏")
    private String password;
}
```

Contents of src/main/java/ru/gigastack/ai_reminder_back/dto/SignUpRequest.java:
```
package ru.gigastack.ai_reminder_back.dto;

import io.swagger.v3.oas.annotations.media.Schema;
import jakarta.validation.constraints.Email;
import jakarta.validation.constraints.NotBlank;
import jakarta.validation.constraints.Size;
import lombok.Data;

@Data
@Schema(description = "–ó–∞–ø—Ä–æ—Å –Ω–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é")
public class SignUpRequest {

    @Schema(description = "–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è", example = "Jon")
    @Size(min = 5, max = 50, message = "–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–æ–ª–∂–Ω–æ —Å–æ–¥–µ—Ä–∂–∞—Ç—å –æ—Ç 5 –¥–æ 50 —Å–∏–º–≤–æ–ª–æ–≤")
    @NotBlank(message = "–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—É—Å—Ç—ã–º–∏")
    private String username;

    /*@Schema(description = "–ê–¥—Ä–µ—Å —ç–ª–µ–∫—Ç—Ä–æ–Ω–Ω–æ–π –ø–æ—á—Ç—ã", example = "jondoe@gmail.com")
    @Size(min = 5, max = 255, message = "–ê–¥—Ä–µ—Å —ç–ª–µ–∫—Ç—Ä–æ–Ω–Ω–æ–π –ø–æ—á—Ç—ã –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å –æ—Ç 5 –¥–æ 255 —Å–∏–º–≤–æ–ª–æ–≤")
    @NotBlank(message = "–ê–¥—Ä–µ—Å —ç–ª–µ–∫—Ç—Ä–æ–Ω–Ω–æ–π –ø–æ—á—Ç—ã –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—É—Å—Ç—ã–º–∏")
    @Email(message = "Email –∞–¥—Ä–µ—Å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤ —Ñ–æ—Ä–º–∞—Ç–µ user@example.com")
    private String email;*/

    @Schema(description = "–ü–∞—Ä–æ–ª—å", example = "my_1secret1_password")
    @Size(max = 255, message = "–î–ª–∏–Ω–∞ –ø–∞—Ä–æ–ª—è –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –Ω–µ –±–æ–ª–µ–µ 255 —Å–∏–º–≤–æ–ª–æ–≤")
    private String password;
}
```

Contents of src/main/java/ru/gigastack/ai_reminder_back/dto/JwtAuthenticationResponse.java:
```
package ru.gigastack.ai_reminder_back.dto;

import io.swagger.v3.oas.annotations.media.Schema;
import lombok.AllArgsConstructor;
import lombok.Builder;
import lombok.Data;
import lombok.NoArgsConstructor;

@Data
@Builder
@NoArgsConstructor
@AllArgsConstructor
@Schema(description = "–û—Ç–≤–µ—Ç c —Ç–æ–∫–µ–Ω–æ–º –¥–æ—Å—Ç—É–ø–∞")
public class JwtAuthenticationResponse {
    @Schema(description = "–¢–æ–∫–µ–Ω –¥–æ—Å—Ç—É–ø–∞", example = "eyJhbGciOiJIUzUxMiJ9.eyJzdWIiOiJhZG1pbiIsImV4cCI6MTYyMjUwNj...")
    private String token;
}
```

Contents of src/main/java/ru/gigastack/ai_reminder_back/repository/UserRepository.java:
```
package ru.gigastack.ai_reminder_back.repository;

import org.springframework.data.jpa.repository.JpaRepository;
import org.springframework.stereotype.Repository;
import ru.gigastack.ai_reminder_back.models.User;

import java.util.Optional;

@Repository
public interface UserRepository extends JpaRepository<User, Long> {

    Optional<User> findByUsername(String username);
    boolean existsByUsername(String username);

    /* --- tg_id —Ç–µ–ø–µ—Ä—å —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ –≤–∏–¥–µ —Å—Ç—Ä–æ–∫–∏ --- */
    Optional<User> findByTgId(String tgId);
    boolean existsByTgId(String tgId);
}
```

Contents of src/main/java/ru/gigastack/ai_reminder_back/config/OpenApiConfig.java:
```
package ru.gigastack.ai_reminder_back.config;

import io.swagger.v3.oas.annotations.OpenAPIDefinition;
import io.swagger.v3.oas.annotations.enums.SecuritySchemeIn;
import io.swagger.v3.oas.annotations.enums.SecuritySchemeType;
import io.swagger.v3.oas.annotations.info.Contact;
import io.swagger.v3.oas.annotations.info.Info;
import io.swagger.v3.oas.annotations.info.License;
import io.swagger.v3.oas.annotations.security.SecurityScheme;
import io.swagger.v3.oas.annotations.servers.Server;

/**
 * –ì–ª–æ–±–∞–ª—å–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è OpenAPI 3 (swagger-ui).
 *
 * ‚ö†Ô∏è –ù–∏–∫–∞–∫–æ–π –ª–æ–≥–∏–∫–∏ ‚Äî —Ç–æ–ª—å–∫–æ –∞–Ω–Ω–æ—Ç–∞—Ü–∏–∏.
 */
@OpenAPIDefinition(
        info = @Info(
                title       = "AI-Reminder API",
                version     = "v1",
                description = """
                        **–ú–∏–∫—Ä–æ-backend –ª–∏—á–Ω–æ–≥–æ –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–∞ / –Ω–∞–ø–æ–º–∏–Ω–∞–ª–æ–∫**

                        * –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è ‚Äî JWT (Bearer)  
                        * CRUD –ø–æ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è–º  
                        * Outbox-–º–µ—Ö–∞–Ω–∏–∑–º -> WebSocket / Telegram  
                        * —Ä–æ–ª–∏: USER / ADMIN
                        """,
                contact = @Contact(
                        name  = "Backend team",
                        email = "dev@gigastack.ru",
                        url   = "https://github.com/VGorHub/HITs_hack_back"
                ),
                license = @License(
                        name = "MIT",
                        url  = "https://opensource.org/licenses/MIT"
                )
        ),
        servers = {
                @Server(url = "https://192.168.1.3:8443", description = "Local DEV"),
                @Server(url = "https://api.ai-reminder.dev", description = "Prod")
        }
)
@SecurityScheme(
        name         = "BearerAuth",
        type         = SecuritySchemeType.HTTP,
        scheme       = "bearer",
        bearerFormat = "JWT",
        in           = SecuritySchemeIn.HEADER
)
public class OpenApiConfig { /* –ø—É—Å—Ç–æ */ }
```

Contents of src/main/java/ru/gigastack/ai_reminder_back/security/JwtService.java:
```
package ru.gigastack.ai_reminder_back.security;

import io.jsonwebtoken.Claims;
import io.jsonwebtoken.Jwts;
import io.jsonwebtoken.SignatureAlgorithm;
import io.jsonwebtoken.io.Decoders;
import io.jsonwebtoken.security.Keys;
import org.springframework.beans.factory.annotation.Value;
import org.springframework.security.core.userdetails.UserDetails;
import org.springframework.stereotype.Service;
import ru.gigastack.ai_reminder_back.models.User;

import java.security.Key;
import java.util.Date;
import java.util.HashMap;
import java.util.Map;
import java.util.function.Function;

@Service
public class JwtService {
    @Value("${token.signing.key}")
    private String jwtSigningKey;

    /**
     * –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –∏–º–µ–Ω–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ —Ç–æ–∫–µ–Ω–∞
     *
     * @param token —Ç–æ–∫–µ–Ω
     * @return –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
     */
    public String extractUserName(String token) {
        return extractClaim(token, Claims::getSubject);
    }

    /**
     * –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ç–æ–∫–µ–Ω–∞
     *
     * @param userDetails –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
     * @return —Ç–æ–∫–µ–Ω
     */
    public String generateToken(UserDetails userDetails) {
        Map<String, Object> claims = new HashMap<>();
        if (userDetails instanceof User customUserDetails) {
            claims.put("id", customUserDetails.getId());
//            claims.put("email", customUserDetails.getEmail());
            claims.put("role", customUserDetails.getRole());
        }
        return generateToken(claims, userDetails);
    }

    /**
     * –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–æ–∫–µ–Ω–∞ –Ω–∞ –≤–∞–ª–∏–¥–Ω–æ—Å—Ç—å
     *
     * @param token       —Ç–æ–∫–µ–Ω
     * @param userDetails –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
     * @return true, –µ—Å–ª–∏ —Ç–æ–∫–µ–Ω –≤–∞–ª–∏–¥–µ–Ω
     */
    public boolean isTokenValid(String token, UserDetails userDetails) {
        final String userName = extractUserName(token);
        return (userName.equals(userDetails.getUsername())) && !isTokenExpired(token);
    }

    /**
     * –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∏–∑ —Ç–æ–∫–µ–Ω–∞
     *
     * @param token           —Ç–æ–∫–µ–Ω
     * @param claimsResolvers —Ñ—É–Ω–∫—Ü–∏—è –∏–∑–≤–ª–µ—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö
     * @param <T>             —Ç–∏–ø –¥–∞–Ω–Ω—ã—Ö
     * @return –¥–∞–Ω–Ω—ã–µ
     */
    private <T> T extractClaim(String token, Function<Claims, T> claimsResolvers) {
        final Claims claims = extractAllClaims(token);
        return claimsResolvers.apply(claims);
    }

    /**
     * –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ç–æ–∫–µ–Ω–∞
     *
     * @param extraClaims –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
     * @param userDetails –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
     * @return —Ç–æ–∫–µ–Ω
     */
    private String generateToken(Map<String, Object> extraClaims, UserDetails userDetails) {
        return Jwts.builder().setClaims(extraClaims).setSubject(userDetails.getUsername())
                .setIssuedAt(new Date(System.currentTimeMillis()))
                .setExpiration(new Date(System.currentTimeMillis() + 100000 * 60 * 24))
                .signWith(getSigningKey(), SignatureAlgorithm.HS256).compact();
    }

    /**
     * –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–æ–∫–µ–Ω–∞ –Ω–∞ –ø—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω–æ—Å—Ç—å
     *
     * @param token —Ç–æ–∫–µ–Ω
     * @return true, –µ—Å–ª–∏ —Ç–æ–∫–µ–Ω –ø—Ä–æ—Å—Ä–æ—á–µ–Ω
     */
    private boolean isTokenExpired(String token) {
        return extractExpiration(token).before(new Date());
    }

    /**
     * –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –¥–∞—Ç—ã –∏—Å—Ç–µ—á–µ–Ω–∏—è —Ç–æ–∫–µ–Ω–∞
     *
     * @param token —Ç–æ–∫–µ–Ω
     * @return –¥–∞—Ç–∞ –∏—Å—Ç–µ—á–µ–Ω–∏—è
     */
    private Date extractExpiration(String token) {
        return extractClaim(token, Claims::getExpiration);
    }

    /**
     * –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –≤—Å–µ—Ö –¥–∞–Ω–Ω—ã—Ö –∏–∑ —Ç–æ–∫–µ–Ω–∞
     *
     * @param token —Ç–æ–∫–µ–Ω
     * @return –¥–∞–Ω–Ω—ã–µ
     */
    private Claims extractAllClaims(String token) {
        return Jwts.parser().setSigningKey(getSigningKey()).build().parseClaimsJws(token)
                .getBody();
    }

    /**
     * –ü–æ–ª—É—á–µ–Ω–∏–µ –∫–ª—é—á–∞ –¥–ª—è –ø–æ–¥–ø–∏—Å–∏ —Ç–æ–∫–µ–Ω–∞
     *
     * @return –∫–ª—é—á
     */
    private Key getSigningKey() {
        byte[] keyBytes = Decoders.BASE64.decode(jwtSigningKey);
        return Keys.hmacShaKeyFor(keyBytes);
    }
    public boolean validateToken(String token) {
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç–æ–ª—å–∫–æ —Å—Ä–æ–∫ –≥–æ–¥–Ω–æ—Å—Ç–∏; –µ—Å–ª–∏ –Ω—É–∂–Ω–∞ –¥–æ–ø.-–ª–æ–≥–∏–∫–∞ ‚Äî –¥–æ–±–∞–≤—å—Ç–µ.
        return !isTokenExpired(token);
    }

    public Long getUserId(String token) {
        // id —Å–æ—Ö—Ä–∞–Ω—è–ª–∏ –≤ claim "id" –ø—Ä–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Ç–æ–∫–µ–Ω–∞
        return extractClaim(token, c -> c.get("id", Long.class));
    }

    public String getAuthorities(String token) {
        // role –∫–ª–∞–¥—ë—Ç—Å—è —Å—Ç—Ä–æ–∫–æ–π, –Ω–∞–ø—Ä–∏–º–µ—Ä ROLE_USER
        return extractClaim(token, c -> c.get("role", String.class));
    }
}
```

Contents of src/main/java/ru/gigastack/ai_reminder_back/security/JsonAuthHandlers.java:
```
package ru.gigastack.ai_reminder_back.security;

import com.fasterxml.jackson.databind.ObjectMapper;
import jakarta.servlet.http.HttpServletRequest;
import jakarta.servlet.http.HttpServletResponse;
import lombok.RequiredArgsConstructor;
import lombok.extern.slf4j.Slf4j;
import org.springframework.http.HttpStatus;
import org.springframework.security.access.AccessDeniedException;
import org.springframework.security.core.AuthenticationException;
import org.springframework.security.web.AuthenticationEntryPoint;
import org.springframework.security.web.access.AccessDeniedHandler;
import org.springframework.stereotype.Component;
import ru.gigastack.ai_reminder_back.exception.ApiError;

import java.io.IOException;
import java.time.OffsetDateTime;

/**
 * –î–µ–ª–∞–µ—Ç Spring Security-–æ—à–∏–±–∫–∏ (401 / 403) –æ–¥–Ω–æ—Ç–∏–ø–Ω—ã–º–∏ —Å MVC-–æ—à–∏–±–∫–∞–º–∏.
 */
@Slf4j
@Component
@RequiredArgsConstructor
public class JsonAuthHandlers implements AuthenticationEntryPoint, AccessDeniedHandler {

    private final ObjectMapper mapper;

    /* -------- 401: –Ω–µ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω -------- */

    @Override
    public void commence(HttpServletRequest request,
                         HttpServletResponse response,
                         AuthenticationException authException) throws IOException {

        send(HttpStatus.UNAUTHORIZED, "Unauthorized", request, response);
    }

    /* -------- 403: –Ω–µ—Ç –ø—Ä–∞–≤ -------- */

    @Override
    public void handle(HttpServletRequest request,
                       HttpServletResponse response,
                       AccessDeniedException accessDeniedException) throws IOException {

        send(HttpStatus.FORBIDDEN, "Forbidden", request, response);
    }

    /* -------- util -------- */

    private void send(HttpStatus status,
                      String message,
                      HttpServletRequest req,
                      HttpServletResponse resp) throws IOException {

        ApiError body = ApiError.builder()
                .timestamp(OffsetDateTime.now())
                .status(status.value())
                .error(status.getReasonPhrase())
                .message(message)
                .path(req.getRequestURI())
                .build();

        resp.setStatus(status.value());
        resp.setContentType("application/json");
        mapper.writeValue(resp.getWriter(), body);

        log.warn("{} {} ‚Üí {} {}", req.getMethod(), req.getRequestURI(),
                status.value(), message);
    }
}

```

Contents of src/main/java/ru/gigastack/ai_reminder_back/security/AuthenticationService.java:
```
package ru.gigastack.ai_reminder_back.security;

import lombok.RequiredArgsConstructor;
import org.springframework.security.authentication.AuthenticationManager;
import org.springframework.security.authentication.UsernamePasswordAuthenticationToken;
import org.springframework.security.crypto.password.PasswordEncoder;
import org.springframework.stereotype.Service;
import ru.gigastack.ai_reminder_back.dto.JwtAuthenticationResponse;
import ru.gigastack.ai_reminder_back.dto.SignInRequest;
import ru.gigastack.ai_reminder_back.dto.SignUpRequest;
import ru.gigastack.ai_reminder_back.models.Role;
import ru.gigastack.ai_reminder_back.models.User;
import ru.gigastack.ai_reminder_back.service.UserService;

@Service
@RequiredArgsConstructor
public class AuthenticationService {
    private final UserService userService;
    private final JwtService jwtService;
    private final PasswordEncoder passwordEncoder;
    private final AuthenticationManager authenticationManager;

    /**
     * –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
     *
     * @param request –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
     * @return —Ç–æ–∫–µ–Ω
     */
    public JwtAuthenticationResponse signUp(SignUpRequest request) {

        var user = User.builder()
                .username(request.getUsername())
//                .email(request.getEmail())
                .password(passwordEncoder.encode(request.getPassword()))
                .role(Role.ROLE_USER)
                .build();

        userService.create(user);

        var jwt = jwtService.generateToken(user);
        return new JwtAuthenticationResponse(jwt);
    }

    /**
     * –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
     *
     * @param request –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
     * @return —Ç–æ–∫–µ–Ω
     */
    public JwtAuthenticationResponse signIn(SignInRequest request) {
        authenticationManager.authenticate(new UsernamePasswordAuthenticationToken(
                request.getUsername(),
                request.getPassword()
        ));

        var user = userService
                .userDetailsService()
                .loadUserByUsername(request.getUsername());

        var jwt = jwtService.generateToken(user);
        return new JwtAuthenticationResponse(jwt);
    }
}

```

Contents of src/main/java/ru/gigastack/ai_reminder_back/security/JwtAuthenticationFilter.java:
```
package ru.gigastack.ai_reminder_back.security;

import jakarta.servlet.FilterChain;
import jakarta.servlet.http.HttpServletRequest;
import jakarta.servlet.http.HttpServletResponse;
import lombok.RequiredArgsConstructor;
import lombok.extern.slf4j.Slf4j;
import org.springframework.security.authentication.UsernamePasswordAuthenticationToken;
import org.springframework.security.core.context.SecurityContextHolder;
import org.springframework.security.web.authentication.WebAuthenticationDetailsSource;
import org.springframework.util.StringUtils;
import org.springframework.web.filter.OncePerRequestFilter;

@Slf4j
@RequiredArgsConstructor
public class JwtAuthenticationFilter extends OncePerRequestFilter {

    private final JwtTokenProvider tokenProvider;

    @Override
    protected void doFilterInternal(HttpServletRequest request,
                                    HttpServletResponse response,
                                    FilterChain filterChain) {
        try {
            String token = resolveToken(request);
            if (StringUtils.hasText(token) && tokenProvider.validate(token)) {

                var auth = new UsernamePasswordAuthenticationToken(
                        tokenProvider.getUserId(token),      // principal
                        null,                                // credentials
                        tokenProvider.getAuthorities(token)  // roles
                );
                auth.setDetails(
                        new WebAuthenticationDetailsSource().buildDetails(request)
                );
                SecurityContextHolder.getContext().setAuthentication(auth);
            }
        } catch (Exception ex) {
            log.warn("JWT auth failed: {}", ex.getMessage());
        }

        try {
            filterChain.doFilter(request, response);
        } catch (Exception e) {
            throw new RuntimeException(e);
        }
    }

    /**
     * 1) Header  Authorization: Bearer &lt;jwt&gt;<br>
     * 2) Query-param ?token=&lt;jwt&gt;  ‚Äî –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –±—Ä–∞—É–∑–µ—Ä–æ–º –ø—Ä–∏ WebSocket-handshake.
     */
    private String resolveToken(HttpServletRequest req) {
        // #1  ‚Äî —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç
        String bearer = req.getHeader("Authorization");
        if (StringUtils.hasText(bearer) && bearer.startsWith("Bearer ")) {
            return bearer.substring(7);
        }
        // #2  ‚Äî fallback –¥–ª—è /ws?token=<jwt>
        String qp = req.getParameter("token");
        return StringUtils.hasText(qp) ? qp : null;
    }
}
```

Contents of src/main/java/ru/gigastack/ai_reminder_back/security/JwtTokenProvider.java:
```
package ru.gigastack.ai_reminder_back.security;

import lombok.RequiredArgsConstructor;
import org.springframework.security.core.GrantedAuthority;
import org.springframework.security.core.authority.SimpleGrantedAuthority;
import org.springframework.stereotype.Component;

import java.util.Collection;
import java.util.List;

/**
 * –ê–¥–∞–ø—Ç–µ—Ä –Ω–∞–¥ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º JwtService, —á—Ç–æ–±—ã —Ñ–∏–ª—å—Ç—Ä –Ω–∏—á–µ–≥–æ –Ω–µ –∑–Ω–∞–ª
 * –æ –¥–µ—Ç–∞–ª—è—Ö —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏.
 */
@Component
@RequiredArgsConstructor
public class JwtTokenProvider {

    private final JwtService jwtService;   // ‚Üê —É–∂–µ –µ—Å—Ç—å –≤ –ø—Ä–æ–µ–∫—Ç–µ

    public boolean validate(String token) {
        return jwtService.validateToken(token);
    }

    public Long getUserId(String token) {
        return jwtService.getUserId(token);
    }

    public Collection<? extends GrantedAuthority> getAuthorities(String token) {
        // –∏–∑ –æ–±—ë—Ä—Ç–∫–∏ JwtService –ø–æ–ª—É—á–∞–µ–º —Ä–æ–ª—å —Å—Ç—Ä–æ–∫–æ–π
        String role = jwtService.getAuthorities(token);   // ROLE_USER, ROLE_ADMIN ‚Ä¶
        return List.of(new SimpleGrantedAuthority(role));
    }

}
```

Contents of src/main/java/ru/gigastack/ai_reminder_back/security/SecurityConfiguration.java:
```
package ru.gigastack.ai_reminder_back.security;

import lombok.RequiredArgsConstructor;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.http.HttpMethod;
import org.springframework.security.authentication.AuthenticationManager;
import org.springframework.security.authentication.AuthenticationProvider;
import org.springframework.security.authentication.dao.DaoAuthenticationProvider;
import org.springframework.security.config.annotation.authentication.configuration.AuthenticationConfiguration;
import org.springframework.security.config.annotation.method.configuration.EnableMethodSecurity;
import org.springframework.security.config.annotation.web.builders.HttpSecurity;
import org.springframework.security.config.annotation.web.configuration.EnableWebSecurity;
import org.springframework.security.config.annotation.web.configurers.AbstractHttpConfigurer;
import org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder;
import org.springframework.security.crypto.password.PasswordEncoder;
import org.springframework.security.web.SecurityFilterChain;
import org.springframework.security.web.authentication.UsernamePasswordAuthenticationFilter;
import org.springframework.web.cors.CorsConfiguration;
import ru.gigastack.ai_reminder_back.service.UserService;

import java.util.List;

import static org.springframework.security.config.http.SessionCreationPolicy.STATELESS;

@Configuration
@EnableWebSecurity
@EnableMethodSecurity
@RequiredArgsConstructor
public class SecurityConfiguration {

    private final UserService              userService;
    private final JsonAuthHandlers         jsonHandlers;
    private final JwtTokenProvider tokenProvider;

    @Bean
    public JwtAuthenticationFilter jwtAuthenticationFilter() {
        return new JwtAuthenticationFilter(tokenProvider);
    }
    /* ---------- –æ—Å–Ω–æ–≤–Ω–∞—è —Ü–µ–ø–æ—á–∫–∞ ---------- */
    @Bean
    public SecurityFilterChain securityFilterChain(HttpSecurity http) throws Exception {

        http.csrf(AbstractHttpConfigurer::disable)

                .cors(cors -> cors.configurationSource(request -> {
                    CorsConfiguration cfg = new CorsConfiguration();
                    cfg.setAllowedOriginPatterns(List.of("*"));
                    cfg.setAllowedMethods(List.of("GET", "POST", "PUT", "DELETE", "OPTIONS"));
                    cfg.setAllowedHeaders(List.of("*"));
                    cfg.setAllowCredentials(true);
                    return cfg;
                }))


                .authorizeHttpRequests(auth -> auth
                        .requestMatchers("/auth/**",
                                "/swagger-ui/**",
                                "/v3/api-docs/**",
                                "/swagger-ui.html",
                                "/favicon.ico",
                                "/internal/telegram/chat",
                                "/internal/telegram/user-info").permitAll()
                        .requestMatchers(HttpMethod.GET, "/ws/**").permitAll()
                        .requestMatchers(HttpMethod.OPTIONS, "/ws/**").permitAll()
                        .anyRequest().authenticated())

                .exceptionHandling(ex -> ex
                        .authenticationEntryPoint(jsonHandlers)
                        .accessDeniedHandler(jsonHandlers))

                .sessionManagement(sm -> sm.sessionCreationPolicy(STATELESS))
                .authenticationProvider(authenticationProvider())

                .addFilterBefore(
                        jwtAuthenticationFilter(),
                        UsernamePasswordAuthenticationFilter.class
                );
        return http.build();
    }


    @Bean
    public PasswordEncoder passwordEncoder() {
        return new BCryptPasswordEncoder();
    }

    @Bean
    public AuthenticationProvider authenticationProvider() {
        DaoAuthenticationProvider provider = new DaoAuthenticationProvider();
        provider.setUserDetailsService(userService.userDetailsService());
        provider.setPasswordEncoder(passwordEncoder());
        return provider;
    }

    @Bean
    public AuthenticationManager authenticationManager(AuthenticationConfiguration cfg)
            throws Exception {
        return cfg.getAuthenticationManager();
    }
}

```

Contents of src/main/java/ru/gigastack/ai_reminder_back/notification/.DS_Store:
```
[Could not decode file contents]

```

Contents of src/main/java/ru/gigastack/ai_reminder_back/notification/dto/ReminderNotification.java:
```
package ru.gigastack.ai_reminder_back.notification.dto;

import java.time.OffsetDateTime;

/**
 * –¢–æ, —á—Ç–æ —Ä–µ–∞–ª—å–Ω–æ —É—Ö–æ–¥–∏—Ç –≤–æ —Ñ—Ä–æ–Ω—Ç / Telegram.
 * –ó–¥–µ—Å—å —Ç–æ–ª—å–∫–æ —Ç–µ –¥–∞–Ω–Ω—ã–µ, –∫–æ—Ç–æ—Ä—ã–µ –Ω—É–∂–Ω—ã –∫–∞–Ω–∞–ª—É –¥–æ—Å—Ç–∞–≤–∫–∏.
 */
public record ReminderNotification(
        Long          reminderId,
        Long          userId,
        String        title,
        String        description,
        OffsetDateTime scheduledAt,
        String        location
) {}
```

Contents of src/main/java/ru/gigastack/ai_reminder_back/notification/repository/OutboxRepository.java:
```
package ru.gigastack.ai_reminder_back.notification.repository;

import org.springframework.data.jpa.repository.*;
import org.springframework.data.repository.query.Param;
import org.springframework.stereotype.Repository;
import ru.gigastack.ai_reminder_back.notification.model.OutboxNotification;

import java.time.LocalDateTime;
import java.time.OffsetDateTime;
import java.time.ZonedDateTime;
import java.util.*;

@Repository
public interface OutboxRepository extends JpaRepository<OutboxNotification, Long> {

    /** –¢–æ–ª—å–∫–æ —Ç–µ, —á—Ç–æ –ø–æ—Ä–∞ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å ‚Äì reminder —É–∂–µ ¬´–Ω–∞—Å—Ç–∞–ª¬ª */
    @Query("""
       select on
         from OutboxNotification on
         join Reminder r on r.id = on.reminderId
        where on.processed = false
          and r.scheduledAt <= :now
       """)
    List<OutboxNotification> findReady(@Param("now") OffsetDateTime now);
}

```

Contents of src/main/java/ru/gigastack/ai_reminder_back/notification/channel/N8nWebhookGateway.java:
```
package ru.gigastack.ai_reminder_back.notification.channel;

import lombok.RequiredArgsConstructor;
import lombok.extern.slf4j.Slf4j;
import org.springframework.beans.factory.annotation.Value;
import org.springframework.context.annotation.Primary;
import org.springframework.http.MediaType;
import org.springframework.stereotype.Component;
import org.springframework.web.reactive.function.client.WebClient;
import ru.gigastack.ai_reminder_back.notification.dto.ReminderNotification;
import ru.gigastack.ai_reminder_back.notification.service.TelegramGateway;

import java.util.Map;

@Component @Primary
@RequiredArgsConstructor
@Slf4j

public class N8nWebhookGateway implements TelegramGateway {

    @Value("${n8n.webhook.url}")
    private String webhookUrl;

    private final WebClient webClient = WebClient.builder().build();

    @Override
    public void push(Long chatId, ReminderNotification payload) {
        try {
            webClient.post()
                    .uri(webhookUrl)
                    .contentType(MediaType.APPLICATION_JSON)
                    .bodyValue(Map.of("chat_id", chatId, "notification", payload))
                    .retrieve()
                    .toBodilessEntity()
                    .block();
            log.debug("[n8n] ‚Üí {} {}", chatId, payload);
        } catch (Exception e) {
            // WARN –≤–º–µ—Å—Ç–æ ERROR, —á—Ç–æ–± –Ω–µ –∫—Ä–∞—Å–Ω–µ–ª–æ
            log.warn("[n8n] push failed ({}): {}", webhookUrl, e.getMessage());
        }
    }
}
```

Contents of src/main/java/ru/gigastack/ai_reminder_back/notification/model/OutboxNotification.java:
```
package ru.gigastack.ai_reminder_back.notification.model;

import jakarta.persistence.*;
import lombok.*;
import java.time.*;

@Entity
@Table(name = "outbox_notifications")
@Getter @Setter @NoArgsConstructor @AllArgsConstructor @Builder
public class OutboxNotification {

    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;

    private Long reminderId;
    private Long userId;

    /** JSON-payload —Ç–µ–ø–µ—Ä—å —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ TEXT, —á—Ç–æ–±—ã –Ω–µ –æ–±—Ä–µ–∑–∞—Ç—å –¥–ª–∏–Ω–Ω—ã–µ —Å—Ç—Ä–æ–∫–∏ */
    @Column(columnDefinition = "TEXT")
    private String payload;

    private boolean processed;
    private ZonedDateTime createdAt;
}
```

Contents of src/main/java/ru/gigastack/ai_reminder_back/notification/service/OutboxNotifier.java:
```
package ru.gigastack.ai_reminder_back.notification.service;

import com.fasterxml.jackson.databind.ObjectMapper;
import lombok.RequiredArgsConstructor;
import lombok.extern.slf4j.Slf4j;
import org.springframework.scheduling.annotation.Scheduled;
import org.springframework.stereotype.Service;
import org.springframework.transaction.annotation.Transactional;
import ru.gigastack.ai_reminder_back.models.User;
import ru.gigastack.ai_reminder_back.notification.dto.ReminderNotification;
import ru.gigastack.ai_reminder_back.notification.model.OutboxNotification;
import ru.gigastack.ai_reminder_back.notification.repository.OutboxRepository;
import ru.gigastack.ai_reminder_back.socketio.SocketIOGateway;   // ‚Üê –ù–û–í–û–ï
import ru.gigastack.ai_reminder_back.repository.UserRepository;
import ru.gigastack.ai_reminder_back.telegram.repository.TelegramChatRepository;

import java.time.OffsetDateTime;
import java.time.ZoneOffset;

@Service
@RequiredArgsConstructor
@Slf4j
public class OutboxNotifier {

    private final OutboxRepository       repo;
    private final UserRepository         userRepo;
    private final TelegramChatRepository chatRepo;
    private final TelegramGateway        telegramGateway;
    private final SocketIOGateway        socketGateway;   // ‚Üê –ù–û–í–û–ï
    private final ObjectMapper           mapper;

    @Scheduled(fixedDelay = 5_000)
    @Transactional
    public void dispatch() {
        log.debug("[outbox] dispatch tick");
        repo.findReady(OffsetDateTime.now(ZoneOffset.UTC)).forEach(this::sendAndMark);
    }

    private void sendAndMark(OutboxNotification on) {

        ReminderNotification payload = toReminderNotification(on);
        boolean ok = true;

        /* -------- WebSocket -------- */
        try {
            socketGateway.push(on.getUserId(), payload);
        } catch (Exception e) {
            ok = false;
            log.error("WS error, reminderId={}", on.getReminderId(), e);
        }                                              //
        /* -------- Telegram -------- */
        try {
            userRepo.findById(on.getUserId())
                    .map(User::getTgId)              // String
                    .flatMap(chatRepo::findByTgId)   // String ‚Üí Optional<TelegramChat>
                    .ifPresent(chat -> telegramGateway.push(chat.getChatId(), payload));
        } catch (Exception e) {
            ok = false;
            log.error("TG error, reminderId={}", on.getReminderId(), e);
        }

        if (ok) {
            on.setProcessed(true);
            repo.save(on);
        }
    }

    private ReminderNotification toReminderNotification(OutboxNotification on) {
        try {
            return mapper.readValue(on.getPayload(), ReminderNotification.class);
        } catch (Exception e) {
            log.warn("Bad payload, fallback dto. id={}", on.getId(), e);
            return new ReminderNotification(
                    on.getReminderId(),
                    on.getUserId(),
                    "(unknown)",
                    null,
                    null,
                    null              // <-- location –ø–æ-—É–º–æ–ª—á–∞–Ω–∏—é
            );
        }
    }
}
```

Contents of src/main/java/ru/gigastack/ai_reminder_back/notification/service/TelegramGateway.java:
```
package ru.gigastack.ai_reminder_back.notification.service;

import ru.gigastack.ai_reminder_back.notification.dto.ReminderNotification;

public interface TelegramGateway {
    /** chatId ‚Äî –Ω–∞—Å—Ç–æ—è—â–∏–π chat_id Telegram-—á–∞—Ç–∞ */
    void push(Long chatId, ReminderNotification payload);
}
```

Contents of src/main/java/ru/gigastack/ai_reminder_back/reminder/.DS_Store:
```
[Could not decode file contents]

```

Contents of src/main/java/ru/gigastack/ai_reminder_back/reminder/dto/ReminderRequest.java:
```
package ru.gigastack.ai_reminder_back.reminder.dto;

import jakarta.validation.constraints.*;
import java.time.*;

public record ReminderRequest(
        @NotBlank String title,
        String description,
        @NotNull OffsetDateTime scheduledAt,
        String location
) {}

```

Contents of src/main/java/ru/gigastack/ai_reminder_back/reminder/dto/ReminderResponse.java:
```
package ru.gigastack.ai_reminder_back.reminder.dto;

import ru.gigastack.ai_reminder_back.reminder.model.*;
import java.time.*;

public record ReminderResponse(
        Long id,
        String title,
        String description,
        OffsetDateTime scheduledAt,
        String location,
        ReminderState state,
        ReminderSource source
) {}

```

Contents of src/main/java/ru/gigastack/ai_reminder_back/reminder/repository/ReminderRepository.java:
```
package ru.gigastack.ai_reminder_back.reminder.repository;

import org.springframework.data.jpa.repository.*;
import org.springframework.data.repository.query.Param;
import org.springframework.stereotype.Repository;
import ru.gigastack.ai_reminder_back.reminder.model.*;

import java.time.*;
import java.util.*;

@Repository
public interface ReminderRepository extends JpaRepository<Reminder, Long> {

    List<Reminder> findByUserId(Long userId);

    List<Reminder> findByStateAndScheduledAtBefore(ReminderState state,
                                                   OffsetDateTime before);

    @Query("""
       select r
         from Reminder r
        where r.userId = :userId
          and r.scheduledAt > :now
          and r.state   = ru.gigastack.ai_reminder_back.reminder.model.ReminderState.ACTIVE
       """)
    List<Reminder> findUpcoming(@Param("userId") Long userId,
                                @Param("now")     OffsetDateTime now);
}

```

Contents of src/main/java/ru/gigastack/ai_reminder_back/reminder/mapper/ReminderMapper.java:
```
package ru.gigastack.ai_reminder_back.reminder.mapper;

import org.mapstruct.*;
import ru.gigastack.ai_reminder_back.reminder.model.*;
import ru.gigastack.ai_reminder_back.reminder.dto.*;

@Mapper(componentModel = "spring")
public interface ReminderMapper {

    @Mapping(target = "id",          ignore = true)
    @Mapping(target = "userId",      ignore = true)
    @Mapping(target = "state",       ignore = true)
    @Mapping(target = "source",      ignore = true)
    @Mapping(target = "externalCalendarEventId", ignore = true)
    @Mapping(target = "createdAt",   ignore = true)
    Reminder toEntity(ReminderRequest dto);

    ReminderResponse toDto(Reminder entity);
}
```

Contents of src/main/java/ru/gigastack/ai_reminder_back/reminder/controller/ReminderController.java:
```
package ru.gigastack.ai_reminder_back.reminder.controller;

import io.swagger.v3.oas.annotations.Operation;
import io.swagger.v3.oas.annotations.media.Content;
import io.swagger.v3.oas.annotations.media.ExampleObject;
import io.swagger.v3.oas.annotations.media.Schema;
import io.swagger.v3.oas.annotations.responses.ApiResponse;
import io.swagger.v3.oas.annotations.security.SecurityRequirement;
import io.swagger.v3.oas.annotations.tags.Tag;
import jakarta.validation.Valid;
import lombok.RequiredArgsConstructor;
import org.springframework.http.*;
import org.springframework.security.access.AccessDeniedException;
import org.springframework.security.core.Authentication;
import org.springframework.security.core.context.SecurityContextHolder;
import org.springframework.web.bind.annotation.*;
import ru.gigastack.ai_reminder_back.exception.ApiError;
import ru.gigastack.ai_reminder_back.reminder.dto.*;
import ru.gigastack.ai_reminder_back.reminder.service.ReminderService;

import java.util.List;

@SecurityRequirement(name = "BearerAuth")
@RestController
@RequestMapping("/api/v1/reminders")
@RequiredArgsConstructor
@Tag(name = "–ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è", description = "CRUD + —Å–ø–∏—Å–æ–∫ –ø—Ä–µ–¥—Å—Ç–æ—è—â–∏—Ö")
public class ReminderController {

    private final ReminderService service;

    /* ---------- util ---------- */

    /** –î–æ—Å—Ç–∞—ë–º userId, –∫–æ—Ç–æ—Ä—ã–π —Ñ–∏–ª—å—Ç—Ä –ø–æ–ª–æ–∂–∏–ª –≤ principal (Long –∏–ª–∏ String). */
    private Long getUserId() {
        Authentication auth = SecurityContextHolder.getContext().getAuthentication();
        if (auth == null || auth.getPrincipal() == null) {
            throw new AccessDeniedException("Unauthenticated");
        }

        Object principal = auth.getPrincipal();
        return (principal instanceof Long id)
                ? id
                : Long.valueOf(principal.toString());
    }

    /* ---------- create ---------- */

    @Operation(
            summary     = "–°–æ–∑–¥–∞—Ç—å –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ",
            description = "–í—Ä–µ–º—è (scheduledAt) –æ–∂–∏–¥–∞–µ—Ç—Å—è **–≤ –ª—é–±–æ–º TZ**: ISO-8601 ‚Üí —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ –ë–î –∫–∞–∫ TIMESTAMPTZ.",
            requestBody = @io.swagger.v3.oas.annotations.parameters.RequestBody(
                    required = true,
                    content = @Content(
                            schema = @Schema(implementation = ReminderRequest.class),
                            examples = @ExampleObject(name = "–ü—Ä–∏–º–µ—Ä", value = """
                                    {
                                      "title": "–ü–æ–∑–≤–æ–Ω–∏—Ç—å –±–∞–±—É—à–∫–µ",
                                      "description": "–ü–æ–∑–¥—Ä–∞–≤–∏—Ç—å —Å –¥–Ω—ë–º —Ä–æ–∂–¥–µ–Ω–∏—è",
                                      "scheduledAt": "2025-06-17T13:04:00+07:00",
                                      "location": "–¢–µ–ª–µ—Ñ–æ–Ω"
                                    }""")
                    )
            ),
            responses = {
                    @ApiResponse(responseCode = "201", description = "–°–æ–∑–¥–∞–Ω–æ",
                            content = @Content(schema = @Schema(implementation = ReminderResponse.class))),
                    @ApiResponse(responseCode = "400", description = "–û—à–∏–±–∫–∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏",
                            content = @Content(schema = @Schema(implementation = ApiError.class)))
            }
    )
    @PostMapping
    public ResponseEntity<ReminderResponse> create(@RequestBody @Valid ReminderRequest request) {
        return ResponseEntity.status(HttpStatus.CREATED)
                .body(service.create(getUserId(), request));
    }

    /* ---------- read one ---------- */

    @Operation(
            summary   = "–ü–æ–ª—É—á–∏—Ç—å –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ –ø–æ id",
            responses = {
                    @ApiResponse(responseCode = "200", description = "OK",
                            content = @Content(schema = @Schema(implementation = ReminderResponse.class))),
                    @ApiResponse(responseCode = "404", description = "–ù–µ –Ω–∞–π–¥–µ–Ω–æ / —á—É–∂–æ–µ",
                            content = @Content(schema = @Schema(implementation = ApiError.class)))
            }
    )
    @GetMapping("/{id}")
    public ReminderResponse get(@PathVariable Long id) {
        return service.get(getUserId(), id);
    }

    /* ---------- list all ---------- */

    @Operation(
            summary   = "–°–ø–∏—Å–æ–∫ –í–°–ï–• –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–ø—Ä–æ—à–ª—ã–µ + –±—É–¥—É—â–∏–µ)",
            responses = @ApiResponse(responseCode = "200", description = "OK")
    )
    @GetMapping
    public List<ReminderResponse> list() {
        return service.list(getUserId());
    }

    /* ---------- update ---------- */

    @Operation(
            summary   = "–û–±–Ω–æ–≤–∏—Ç—å –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ",
            responses = {
                    @ApiResponse(responseCode = "200", description = "OK",
                            content = @Content(schema = @Schema(implementation = ReminderResponse.class))),
                    @ApiResponse(responseCode = "404", description = "–ù–µ –Ω–∞–π–¥–µ–Ω–æ",
                            content = @Content(schema = @Schema(implementation = ApiError.class)))
            }
    )
    @PutMapping("/{id}")
    public ReminderResponse update(@PathVariable Long id,
                                   @RequestBody @Valid ReminderRequest request) {
        return service.update(getUserId(), id, request);
    }

    /* ---------- delete ---------- */

    @Operation(
            summary   = "–£–¥–∞–ª–∏—Ç—å –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ",
            responses = {
                    @ApiResponse(responseCode = "204", description = "–£–¥–∞–ª–µ–Ω–æ"),
                    @ApiResponse(responseCode = "404", description = "–ù–µ –Ω–∞–π–¥–µ–Ω–æ",
                            content = @Content(schema = @Schema(implementation = ApiError.class)))
            }
    )
    @DeleteMapping("/{id}")
    @ResponseStatus(HttpStatus.NO_CONTENT)
    public void delete(@PathVariable Long id) {
        service.delete(getUserId(), id);
    }

    /* ---------- upcoming ---------- */

    @Operation(
            summary     = "–°–ø–∏—Å–æ–∫ –ø—Ä–µ–¥—Å—Ç–æ—è—â–∏—Ö (scheduledAt > NOW, state=ACTIVE)",
            description = "–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –±–æ—Ç–æ–º: ¬´—á—Ç–æ —É –º–µ–Ω—è —Å–µ–≥–æ–¥–Ω—è?¬ª",
            responses   = @ApiResponse(responseCode = "200", description = "OK")
    )
    @GetMapping("/upcoming")
    public List<ReminderResponse> upcoming() {
        return service.listUpcoming(getUserId());
    }
}
```

Contents of src/main/java/ru/gigastack/ai_reminder_back/reminder/model/Reminder.java:
```
package ru.gigastack.ai_reminder_back.reminder.model;

import jakarta.persistence.*;
import lombok.*;
import java.time.*;

@Entity
@Table(name = "reminders")
@Getter
@Setter
@NoArgsConstructor
@AllArgsConstructor
@Builder
public class Reminder {

    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;

    private Long userId;

    private String title;

    @Column(length = 2000)
    private String description;

    @Column(name = "scheduled_at", columnDefinition = "TIMESTAMPTZ")
    private OffsetDateTime scheduledAt;

    private String location;  // optional textual location

    @Enumerated(EnumType.STRING)
    private ReminderState state;

    @Enumerated(EnumType.STRING)
    private ReminderSource source;

    private String externalCalendarEventId; // e.g., Google Calendar event ID

    @Column(name = "created_at",   columnDefinition = "TIMESTAMPTZ")
    private OffsetDateTime createdAt;
}

```

Contents of src/main/java/ru/gigastack/ai_reminder_back/reminder/model/ReminderState.java:
```
package ru.gigastack.ai_reminder_back.reminder.model;

public enum ReminderState {
    ACTIVE,
    FIRED,
    CANCELLED
}

```

Contents of src/main/java/ru/gigastack/ai_reminder_back/reminder/model/ReminderSource.java:
```
package ru.gigastack.ai_reminder_back.reminder.model;

public enum ReminderSource {
    TELEGRAM,
    WEB,
    VOICE
}

```

Contents of src/main/java/ru/gigastack/ai_reminder_back/reminder/service/ReminderService.java:
```
package ru.gigastack.ai_reminder_back.reminder.service;

import ru.gigastack.ai_reminder_back.reminder.dto.*;

import java.util.List;

public interface ReminderService {
    ReminderResponse create(Long userId, ReminderRequest req);
    ReminderResponse get(Long userId, Long id);
    List<ReminderResponse> list(Long userId);
    ReminderResponse update(Long userId, Long id, ReminderRequest req);
    void delete(Long userId, Long id);
    List<ReminderResponse> listUpcoming(Long userId);
}

```

Contents of src/main/java/ru/gigastack/ai_reminder_back/reminder/service/ReminderServiceImpl.java:
```
package ru.gigastack.ai_reminder_back.reminder.service;

import com.fasterxml.jackson.databind.ObjectMapper;
import lombok.RequiredArgsConstructor;
import org.springframework.stereotype.Service;
import org.springframework.transaction.annotation.Transactional;
import ru.gigastack.ai_reminder_back.common.NotFoundException;
import ru.gigastack.ai_reminder_back.notification.dto.ReminderNotification;
import ru.gigastack.ai_reminder_back.notification.model.OutboxNotification;
import ru.gigastack.ai_reminder_back.notification.repository.OutboxRepository;
import ru.gigastack.ai_reminder_back.reminder.dto.*;
import ru.gigastack.ai_reminder_back.reminder.mapper.ReminderMapper;
import ru.gigastack.ai_reminder_back.reminder.model.*;
import ru.gigastack.ai_reminder_back.reminder.repository.ReminderRepository;

import java.time.*;
import java.util.List;

@Service
@RequiredArgsConstructor
public class ReminderServiceImpl implements ReminderService {

    private final ReminderRepository repository;
    private final OutboxRepository   outboxRepository;
    private final ReminderMapper     mapper;
    /** –ë–µ—Ä—ë–º —É–∂–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π spring-–æ–≤—Å–∫–∏–π mapper (JavaTimeModule + ISO-8601). */
    private final ObjectMapper       mapperJson;

    /* ---------- create ---------- */
    @Override
    @Transactional
    public ReminderResponse create(Long userId, ReminderRequest req) {

        Reminder reminder = mapper.toEntity(req);
        reminder.setUserId(userId);
        reminder.setState(ReminderState.ACTIVE);
        reminder.setSource(ReminderSource.WEB);
        reminder.setCreatedAt(OffsetDateTime.now(ZoneOffset.UTC));

        Reminder saved = repository.save(reminder);

        /* ‚Äì‚Äì‚Äì payload –¥–ª—è –∫–∞–Ω–∞–ª–æ–≤ –¥–æ—Å—Ç–∞–≤–∫–∏ ‚Äì‚Äì‚Äì */
        ReminderNotification dto = new ReminderNotification(
                saved.getId(),
                userId,
                saved.getTitle(),
                saved.getDescription(),
                saved.getScheduledAt(),
                saved.getLocation()
        );

        String json;
        try {
            json = mapperJson.writeValueAsString(dto);
        } catch (Exception e) {
            throw new IllegalStateException("Failed to serialize ReminderNotification", e);
        }

        /* ‚Äì‚Äì‚Äì outbox ‚Äì‚Äì‚Äì */
        OutboxNotification on = OutboxNotification.builder()
                .reminderId(saved.getId())
                .userId(userId)
                .payload(json)
                .processed(false)
                .createdAt(ZonedDateTime.now(ZoneOffset.UTC))
                .build();
        outboxRepository.save(on);

        return mapper.toDto(saved);
    }

    @Override
    @Transactional(readOnly = true)
    public ReminderResponse get(Long userId, Long id) {
        Reminder r = repository.findById(id)
                .filter(rem -> rem.getUserId().equals(userId))
                .orElseThrow(() -> new NotFoundException("Reminder not found"));
        return mapper.toDto(r);
    }

    @Override
    @Transactional(readOnly = true)
    public List<ReminderResponse> list(Long userId) {
        return repository.findByUserId(userId)
                .stream()
                .map(mapper::toDto)
                .toList();
    }

    @Override
    @Transactional
    public ReminderResponse update(Long userId, Long id, ReminderRequest req) {
        Reminder reminder = repository.findById(id)
                .filter(rem -> rem.getUserId().equals(userId))
                .orElseThrow(() -> new NotFoundException("Reminder not found"));

        reminder.setTitle(req.title());
        reminder.setDescription(req.description());
        reminder.setScheduledAt(req.scheduledAt());
        reminder.setLocation(req.location());
        Reminder saved = repository.save(reminder);
        return mapper.toDto(saved);
    }

    @Override
    @Transactional
    public void delete(Long userId, Long id) {
        Reminder reminder = repository.findById(id)
                .filter(rem -> rem.getUserId().equals(userId))
                .orElseThrow(() -> new NotFoundException("Reminder not found"));
        repository.delete(reminder);
    }

    @Override
    @Transactional(readOnly = true)
    public List<ReminderResponse> listUpcoming(Long userId) {
        return repository.findUpcoming(userId, OffsetDateTime.now(ZoneOffset.UTC))
                .stream()
                .map(mapper::toDto)
                .toList();
    }
}

```

Contents of src/main/java/ru/gigastack/ai_reminder_back/models/User.java:
```
package ru.gigastack.ai_reminder_back.models;

import jakarta.persistence.*;
import lombok.*;
import org.springframework.security.core.GrantedAuthority;
import org.springframework.security.core.authority.SimpleGrantedAuthority;
import org.springframework.security.core.userdetails.UserDetails;

import java.util.Collection;
import java.util.List;


@Entity
@Table(name = "users")
@Getter @Setter @NoArgsConstructor @AllArgsConstructor @Builder
public class User implements UserDetails {

    @Id
    @GeneratedValue(strategy = GenerationType.SEQUENCE, generator = "user_id_seq")
    @SequenceGenerator(name = "user_id_seq", sequenceName = "user_id_seq", allocationSize = 1)
    private Long id;

    @Column(unique = true, nullable = false)
    private String username;

    @Column(nullable = false)
    private String password;

    /** Telegram ID (user_id –≤ Bot API). Nullable ‚Äî —Ç–æ–≥–¥–∞ Telegram-–∫–∞–Ω–∞–ª –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω. */
    @Column(unique = true)
    private String tgId;

    @Enumerated(EnumType.STRING)
    @Column(nullable = false)
    private Role role;

    /* -------- UserDetails boilerplate -------- */
    @Override public Collection<? extends GrantedAuthority> getAuthorities() {
        return List.of(new SimpleGrantedAuthority(role.name()));
    }
    @Override public boolean isAccountNonExpired() { return true; }
    @Override public boolean isAccountNonLocked()  { return true; }
    @Override public boolean isCredentialsNonExpired() { return true; }
    @Override public boolean isEnabled() { return true; }
}
```

Contents of src/main/java/ru/gigastack/ai_reminder_back/models/Role.java:
```
package ru.gigastack.ai_reminder_back.models;

public enum Role {
    ROLE_USER, ROLE_ADMIN
}

```

Contents of src/main/java/ru/gigastack/ai_reminder_back/socketio/SocketIOConfig.java:
```
package ru.gigastack.ai_reminder_back.socketio;

import com.corundumstudio.socketio.SocketIOServer;
import lombok.extern.slf4j.Slf4j;
import org.springframework.beans.factory.annotation.Value;
import org.springframework.boot.ApplicationRunner;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;

/** –í—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π (embedded) —Å–µ—Ä–≤–µ—Ä Socket.IO –Ω–∞ Netty. */
@Configuration
@Slf4j
public class SocketIOConfig {

    @Value("${socketio.port:9092}")
    private Integer port;

    @Bean(destroyMethod = "stop")
    public SocketIOServer socketIOServer() {
        var cfg = new com.corundumstudio.socketio.Configuration();
        cfg.setPort(port);
        cfg.setOrigin("*");                // CORS: –ª—é–±–æ–π origin
        return new SocketIOServer(cfg);
    }

    /** –ê–≤—Ç–æ-—Å—Ç–∞—Ä—Ç –ø–æ—Å–ª–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ Spring-–∫–æ–Ω—Ç–µ–∫—Å—Ç–∞. */
    @Bean
    public ApplicationRunner runner(SocketIOServer server) {
        return args -> {
            server.start();
            log.info("Socket.IO started on 0.0.0.0:{}", port);
        };
    }
}
```

Contents of src/main/java/ru/gigastack/ai_reminder_back/socketio/SocketIOGateway.java:
```
package ru.gigastack.ai_reminder_back.socketio;

import com.corundumstudio.socketio.SocketIOServer;
import lombok.RequiredArgsConstructor;
import lombok.extern.slf4j.Slf4j;
import org.springframework.stereotype.Component;
import ru.gigastack.ai_reminder_back.notification.dto.ReminderNotification;

/** –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–±—ã—Ç–∏–π –≤ –∫–æ–º–Ω–∞—Ç—É ¬´user-{id}¬ª. */
@Component
@RequiredArgsConstructor
@Slf4j
public class SocketIOGateway {

    private final SocketIOServer server;

    public void push(Long userId, ReminderNotification payload) {
        String room = SocketIOListener.room(userId);
        server.getRoomOperations(room).sendEvent("reminder", payload);
        log.debug("[ws] ‚Üí {} {}", room, payload);
    }
}
```

Contents of src/main/java/ru/gigastack/ai_reminder_back/socketio/SocketIOListener.java:
```
package ru.gigastack.ai_reminder_back.socketio;

import com.corundumstudio.socketio.SocketIOServer;
import jakarta.annotation.PostConstruct;
import lombok.RequiredArgsConstructor;
import lombok.extern.slf4j.Slf4j;
import org.springframework.stereotype.Component;
import ru.gigastack.ai_reminder_back.security.JwtTokenProvider;

/**
 * –í–∞–ª–∏–¥–∞—Ü–∏—è JWT (?token=‚Ä¶) –∏ –ø–æ–º–µ—â–µ–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–∞
 * –≤ –∫–æ–º–Ω–∞—Ç—É ¬´user-{id}¬ª.
 */
@Component
@RequiredArgsConstructor
@Slf4j
public class SocketIOListener {

    private final SocketIOServer   server;
    private final JwtTokenProvider tokenProvider;

    @PostConstruct
    public void init() {

        server.addConnectListener(client -> {
            String token = client.getHandshakeData().getSingleUrlParam("token");
            if (token == null || !tokenProvider.validate(token)) {          // ‚Üê validate()
                client.disconnect();
                log.warn("[ws] rejected ‚Äì bad token");
                return;
            }
            Long userId = tokenProvider.getUserId(token);
            client.joinRoom(room(userId));
            log.debug("[ws] {} joined {}", client.getSessionId(), room(userId));
        });

        server.addDisconnectListener(c ->
                log.debug("[ws] {} disconnected", c.getSessionId()));
    }

    /** room-helper: ¬´user-{id}¬ª */
    public static String room(Long userId) {
        return "user-" + userId;
    }
}
```

Contents of src/main/java/ru/gigastack/ai_reminder_back/common/ConflictException.java:
```
package ru.gigastack.ai_reminder_back.common;

import org.springframework.http.HttpStatus;
import org.springframework.web.bind.annotation.ResponseStatus;

@ResponseStatus(HttpStatus.CONFLICT)
public class ConflictException extends RuntimeException {
    public ConflictException(String message) {
        super(message);
    }
}
```

Contents of src/main/java/ru/gigastack/ai_reminder_back/common/NotFoundException.java:
```
package ru.gigastack.ai_reminder_back.common;

import org.springframework.http.HttpStatus;
import org.springframework.web.bind.annotation.ResponseStatus;

@ResponseStatus(HttpStatus.NOT_FOUND)
public class NotFoundException extends RuntimeException {
    public NotFoundException(String message) {
        super(message);
    }
}

```

Contents of src/main/java/ru/gigastack/ai_reminder_back/telegram/TelegramUserInfoController.java:
```
package ru.gigastack.ai_reminder_back.telegram;

import io.swagger.v3.oas.annotations.Operation;
import io.swagger.v3.oas.annotations.media.Content;
import io.swagger.v3.oas.annotations.media.Schema;
import io.swagger.v3.oas.annotations.responses.ApiResponse;
import lombok.RequiredArgsConstructor;
import org.springframework.http.ResponseEntity;
import org.springframework.web.bind.annotation.*;
import ru.gigastack.ai_reminder_back.common.NotFoundException;
import ru.gigastack.ai_reminder_back.exception.ApiError;
import ru.gigastack.ai_reminder_back.repository.UserRepository;
import ru.gigastack.ai_reminder_back.telegram.model.TelegramChat;
import ru.gigastack.ai_reminder_back.telegram.repository.TelegramChatRepository;

@RestController
@RequestMapping("/internal/telegram")
@RequiredArgsConstructor
public class TelegramUserInfoController {

    private final UserRepository         userRepo;
    private final TelegramChatRepository chatRepo;

    @GetMapping("/user-info")
    @Operation(
            summary = "–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ tg_id",
            description = """
                    –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç chatId (–µ—Å–ª–∏ –±–æ—Ç —É–∂–µ –≤–∏–¥–µ–ª —é–∑–µ—Ä–∞) –∏ username.
                    ‚Ä¢ 200 ‚Äì –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–π–¥–µ–Ω  
                    ‚Ä¢ 404 ‚Äì –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å —Ç–∞–∫–∏–º tg_id –Ω–µ—Ç
                    """,
            responses = {
                    @ApiResponse(responseCode = "200", description = "OK",
                            content = @Content(schema =
                            @Schema(implementation = UserInfoResponse.class))),
                    @ApiResponse(responseCode = "404", description = "–ù–µ –Ω–∞–π–¥–µ–Ω",
                            content = @Content(schema =
                            @Schema(implementation = ApiError.class)))
            }
    )
    public ResponseEntity<UserInfoResponse> getUserInfo(@RequestParam String tgId) {

        var user = userRepo.findByTgId(tgId)
                .orElseThrow(() ->
                        new NotFoundException("User with tg_id %s not found".formatted(tgId)));

        Long chatId = chatRepo.findByTgId(tgId)
                .map(TelegramChat::getChatId)
                .orElse(null);

        return ResponseEntity.ok(new UserInfoResponse(user.getUsername(), chatId));
    }

    /* –∫–æ–º–ø–∞–∫—Ç–Ω—ã–π DTO-–æ—Ç–≤–µ—Ç */
    public record UserInfoResponse(String username, Long chatId) {}
}
```

Contents of src/main/java/ru/gigastack/ai_reminder_back/telegram/ProfileController.java:
```
package ru.gigastack.ai_reminder_back.telegram;

import io.swagger.v3.oas.annotations.Operation;
import io.swagger.v3.oas.annotations.media.Content;
import io.swagger.v3.oas.annotations.media.Schema;
import io.swagger.v3.oas.annotations.responses.ApiResponse;
import io.swagger.v3.oas.annotations.security.SecurityRequirement;
import lombok.RequiredArgsConstructor;
import org.springframework.http.ResponseEntity;
import org.springframework.web.bind.annotation.PatchMapping;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestParam;
import org.springframework.web.bind.annotation.RestController;
import ru.gigastack.ai_reminder_back.common.ConflictException;
import ru.gigastack.ai_reminder_back.exception.ApiError;
import ru.gigastack.ai_reminder_back.models.User;
import ru.gigastack.ai_reminder_back.service.UserService;

import java.util.Objects;

@RestController
@RequestMapping("/api/v1/profile")
@RequiredArgsConstructor
@SecurityRequirement(name = "BearerAuth")
public class ProfileController {

    private final UserService userService;

    @PatchMapping("/tg-id")
    @Operation(
            summary = "–ü—Ä–∏–≤—è–∑–∞—Ç—å Telegram-–∞–∫–∫–∞—É–Ω—Ç –∫ –ø—Ä–æ—Ñ–∏–ª—é",
            description = "tg-id –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —É–Ω–∏–∫–∞–ª—å–Ω—ã–º –≤ —Å–∏—Å—Ç–µ–º–µ. " +
                    "–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø—Ä–∏–≤—è–∑–∞–Ω–Ω—ã–π tg-id.",
            responses = {
                    @ApiResponse(responseCode = "200", description = "OK",
                            content = @Content(schema =
                            @Schema(implementation = TgIdResponse.class))),
                    @ApiResponse(responseCode = "409", description = "–£–∂–µ –∑–∞–Ω—è—Ç",
                            content = @Content(schema =
                            @Schema(implementation = ApiError.class)))
            })
    public ResponseEntity<TgIdResponse> setTgId(@RequestParam String tgId) {

        User me = userService.getCurrentUser();

        // —É–∂–µ –º–æ–π ‚Äî –ø—Ä–æ—Å—Ç–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ–º
        if (Objects.equals(me.getTgId(), tgId)) {
            return ResponseEntity.ok(new TgIdResponse(tgId));
        }

        // —á–µ–π-—Ç–æ —á—É–∂–æ–π
        if (userService.existsByTgId(tgId)) {
            throw new ConflictException("–≠—Ç–æ—Ç tg_id —É–∂–µ –ø—Ä–∏–≤—è–∑–∞–Ω –∫ –¥—Ä—É–≥–æ–º—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é");
        }

        me.setTgId(tgId);
        userService.save(me);
        return ResponseEntity.ok(new TgIdResponse(tgId));
    }

    /* ‚Üì –º–∞–ª–µ–Ω—å–∫–∏–π DTO-–æ—Ç–≤–µ—Ç */
    public record TgIdResponse(String tgId) {}
}
```

Contents of src/main/java/ru/gigastack/ai_reminder_back/telegram/TelegramBotHookController.java:
```
package ru.gigastack.ai_reminder_back.telegram;

import io.swagger.v3.oas.annotations.Operation;
import io.swagger.v3.oas.annotations.media.Content;
import io.swagger.v3.oas.annotations.media.Schema;
import io.swagger.v3.oas.annotations.responses.ApiResponse;
import jakarta.validation.Valid;
import lombok.RequiredArgsConstructor;
import org.springframework.http.HttpStatus;
import org.springframework.http.ResponseEntity;
import org.springframework.web.bind.annotation.*;
import ru.gigastack.ai_reminder_back.exception.ApiError;
import ru.gigastack.ai_reminder_back.telegram.dto.TelegramChatUpsertRequest;
import ru.gigastack.ai_reminder_back.telegram.model.TelegramChat;
import ru.gigastack.ai_reminder_back.telegram.repository.TelegramChatRepository;

@RestController
@RequestMapping("/internal/telegram")
@RequiredArgsConstructor
public class TelegramBotHookController {

    private final TelegramChatRepository chatRepo;

    /**
     * Upsert tg_id ‚Üî chat_id ‚Äî –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è Telegram-–±–æ—Ç–æ–º.
     */
    @PostMapping("/chat")
    @Operation(
            summary = "Upsert —Å–≤—è–∑–∏ tg_id ‚Üî chat_id (–≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –±–æ—Ç–æ–º)",
            responses = {
                    @ApiResponse(responseCode = "201", description = "–°–æ–∑–¥–∞–Ω–∞ –Ω–æ–≤–∞—è –ø–∞—Ä–∞"),
                    @ApiResponse(responseCode = "200", description = "–ü–∞—Ä–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∞"),
                    @ApiResponse(responseCode = "400", description = "–ù–µ–≤–µ—Ä–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ",
                            content = @Content(schema = @Schema(implementation = ApiError.class)))
            })
    public ResponseEntity<Void> upsertChat(@RequestBody @Valid TelegramChatUpsertRequest req) {

        boolean created = chatRepo.findById(req.tgId())
                .map(chat -> {                       // UPDATE
                    chat.setChatId(req.chatId());
                    return chatRepo.save(chat);
                })
                .isEmpty();                          // INSERT ‚Äî –æ–±—ä–µ–∫—Ç–∞ –µ—â—ë –Ω–µ—Ç

        if (created) {
            chatRepo.save(TelegramChat.builder()
                    .tgId(req.tgId())
                    .chatId(req.chatId())
                    .build());
            return ResponseEntity.status(HttpStatus.CREATED).build();
        }
        return ResponseEntity.ok().build();
    }
}
```

Contents of src/main/java/ru/gigastack/ai_reminder_back/telegram/dto/TelegramChatUpsertRequest.java:
```
package ru.gigastack.ai_reminder_back.telegram.dto;

import io.swagger.v3.oas.annotations.media.Schema;
import jakarta.validation.constraints.NotBlank;
import jakarta.validation.constraints.NotNull;
import jakarta.validation.constraints.Pattern;

/**
 * DTO, –∫–æ—Ç–æ—Ä—ã–º –±–æ—Ç —Å–æ–æ–±—â–∞–µ—Ç —Å–≤—è–∑–∫—É tg_id ‚Üî chat_id.
 */
public record TelegramChatUpsertRequest(

        @NotBlank
        @Pattern(regexp = "\\d+")                    // —Ç–æ–ª—å–∫–æ —Ü–∏—Ñ—Ä—ã
        @Schema(example = "123456789",
                description = "tg_id –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (—Å—Ç—Ä–æ–∫–∞ —Ü–∏—Ñ—Ä)")
        String tgId,

        @NotNull
        @Schema(example = "987654321",
                description = "ID —á–∞—Ç–∞, –∫—É–¥–∞ —Ä–µ–∞–ª—å–Ω–æ —Å–ª–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è")
        Long chatId
) {}
```

Contents of src/main/java/ru/gigastack/ai_reminder_back/telegram/repository/TelegramChatRepository.java:
```
package ru.gigastack.ai_reminder_back.telegram.repository;

import org.springframework.data.jpa.repository.JpaRepository;
import ru.gigastack.ai_reminder_back.telegram.model.TelegramChat;

import java.util.Optional;

/**
 * CRUD –ø–æ —Ç–∞–±–ª–∏—Ü–µ telegram_chats.
 * tgId —Ö—Ä–∞–Ω–∏—Ç—Å—è —Å—Ç—Ä–æ–∫–æ–π, –ø–æ—ç—Ç–æ–º—É –∫–ª—é—á –∏ –º–µ—Ç–æ–¥—ã —Ä–∞–±–æ—Ç–∞—é—Ç c String.
 */
public interface TelegramChatRepository extends JpaRepository<TelegramChat, String> {

    Optional<TelegramChat> findByTgId(String tgId);
}
```

Contents of src/main/java/ru/gigastack/ai_reminder_back/telegram/model/TelegramChat.java:
```
package ru.gigastack.ai_reminder_back.telegram.model;

import jakarta.persistence.*;
import lombok.*;

@Entity
@Table(name = "telegram_chats")
@Getter @Setter @NoArgsConstructor @AllArgsConstructor @Builder
public class TelegramChat {

    /** tg-user id ‚Äî PRIMARY KEY */
    @Id
    @Column(name = "tg_id")
    private String tgId;

    /** chat_id, –∫—É–¥–∞ —Ä–µ–∞–ª—å–Ω–æ —Å–ª–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è —á–µ—Ä–µ–∑ Bot API */
    @Column(name = "chat_id", nullable = false)
    private Long chatId;
}
```

Contents of src/main/java/ru/gigastack/ai_reminder_back/service/UserService.java:
```
package ru.gigastack.ai_reminder_back.service;

import lombok.RequiredArgsConstructor;
import org.springframework.security.core.context.SecurityContextHolder;
import org.springframework.security.core.userdetails.UserDetailsService;
import org.springframework.security.core.userdetails.UsernameNotFoundException;
import org.springframework.stereotype.Service;
import ru.gigastack.ai_reminder_back.models.Role;
import ru.gigastack.ai_reminder_back.models.User;
import ru.gigastack.ai_reminder_back.repository.UserRepository;

import java.util.Optional;

@Service
@RequiredArgsConstructor
public class UserService {
    private final UserRepository repository;

    /**
     * –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
     *
     * @return —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
     */
    public User save(User user) {
        return repository.save(user);
    }


    /**
     * –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
     *
     * @return —Å–æ–∑–¥–∞–Ω–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
     */
    public User create(User user) {
        if (repository.existsByUsername(user.getUsername())) {
            // –ó–∞–º–µ–Ω–∏—Ç—å –Ω–∞ —Å–≤–æ–∏ –∏—Å–∫–ª—é—á–µ–Ω–∏—è
            throw new RuntimeException("–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å —Ç–∞–∫–∏–º –∏–º–µ–Ω–µ–º —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç");
        }

       /* if (repository.existsByEmail(user.getEmail())) {
            throw new RuntimeException("–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å —Ç–∞–∫–∏–º email —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç");
        }*/

        return save(user);
    }

    /**
     * –ü–æ–ª—É—á–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ –∏–º–µ–Ω–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
     *
     * @return –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
     */
    public User getByUsername(String username) {
        return repository.findByUsername(username)
                .orElseThrow(() -> new UsernameNotFoundException("–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω"));

    }

    /**
     * –ü–æ–ª—É—á–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ –∏–º–µ–Ω–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
     * <p>
     * –ù—É–∂–µ–Ω –¥–ª—è Spring Security
     *
     * @return –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
     */
    public UserDetailsService userDetailsService() {
        return this::getByUsername;
    }

    /**
     * –ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
     *
     * @return —Ç–µ–∫—É—â–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
     */
    public User getCurrentUser() {
        // –ü–æ–ª—É—á–µ–Ω–∏–µ –∏–º–µ–Ω–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ Spring Security
        var username = SecurityContextHolder.getContext().getAuthentication().getName();
        return getByUsername(username);
    }


    /**
     * –í—ã–¥–∞—á–∞ –ø—Ä–∞–≤ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ —Ç–µ–∫—É—â–µ–º—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
     * <p>
     * –ù—É–∂–µ–Ω –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏
     */
    @Deprecated
    public void getAdmin() {
        var user = getCurrentUser();
        user.setRole(Role.ROLE_ADMIN);
        save(user);
    }


    public boolean existsByTgId(String tgId) {          // ‚Üê String
        return repository.existsByTgId(tgId);
    }

    public Optional<User> findByTgId(String tgId) {     // ‚Üê String
        return repository.findByTgId(tgId);
    }
}
```

Contents of src/main/java/ru/gigastack/ai_reminder_back/controllers/AuthController.java:
```
package ru.gigastack.ai_reminder_back.controllers;

import io.swagger.v3.oas.annotations.Operation;
import io.swagger.v3.oas.annotations.media.Content;
import io.swagger.v3.oas.annotations.media.ExampleObject;
import io.swagger.v3.oas.annotations.media.Schema;
import io.swagger.v3.oas.annotations.responses.ApiResponse;
import io.swagger.v3.oas.annotations.security.SecurityRequirement;
import io.swagger.v3.oas.annotations.tags.Tag;
import jakarta.validation.Valid;
import lombok.RequiredArgsConstructor;
import org.springframework.security.access.prepost.PreAuthorize;
import org.springframework.web.bind.annotation.*;
import ru.gigastack.ai_reminder_back.dto.JwtAuthenticationResponse;
import ru.gigastack.ai_reminder_back.dto.SignInRequest;
import ru.gigastack.ai_reminder_back.dto.SignUpRequest;
import ru.gigastack.ai_reminder_back.exception.ApiError;
import ru.gigastack.ai_reminder_back.security.AuthenticationService;
import ru.gigastack.ai_reminder_back.service.UserService;

@RestController
@RequestMapping("/auth")
@RequiredArgsConstructor
@Tag(name = "–ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è", description = "–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è, –ª–æ–≥–∏–Ω, –ø—Ä–∏–º–µ—Ä—ã –∑–∞—â–∏—â—ë–Ω–Ω—ã—Ö —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤")
public class AuthController {

    private final AuthenticationService authenticationService;
    private final UserService           service;

    /* ---------- sign-up ---------- */

    @Operation(
            summary     = "–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è",
            description = "–°–æ–∑–¥–∞—ë—Ç –∑–∞–ø–∏—Å—å –≤ —Ç–∞–±–ª–∏—Ü–µ *users* –∏ —Å—Ä–∞–∑—É –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç JWT.",
            requestBody = @io.swagger.v3.oas.annotations.parameters.RequestBody(
                    required = true,
                    content = @Content(
                            schema = @Schema(implementation = SignUpRequest.class),
                            examples = @ExampleObject(name = "–ü—Ä–∏–º–µ—Ä", value = """
                                    {
                                      "username": "jon_doe",
                                      "password": "my_1secret1_password"
                                    }""")
                    )
            ),
            responses = {
                    @ApiResponse(responseCode = "200",
                            description = "OK (—Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø—Ä–æ—à–ª–∞)",
                            content = @Content(schema = @Schema(implementation = JwtAuthenticationResponse.class))),
                    @ApiResponse(responseCode = "400", description = "–í–∞–ª–∏–¥–∞—Ü–∏—è / –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç",
                            content = @Content(schema = @Schema(implementation = ApiError.class)))
            }
    )
    @PostMapping("/sign-up")
    public JwtAuthenticationResponse signUp(@RequestBody @Valid SignUpRequest request) {
        return authenticationService.signUp(request);
    }

    /* ---------- sign-in ---------- */

    @Operation(
            summary     = "–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è",
            description = "–ü—Ä–∏–Ω–∏–º–∞–µ—Ç –ª–æ–≥–∏–Ω/–ø–∞—Ä–æ–ª—å, –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–≤–µ–∂–∏–π JWT.",
            requestBody = @io.swagger.v3.oas.annotations.parameters.RequestBody(
                    required = true,
                    content = @Content(schema = @Schema(implementation = SignInRequest.class))
            ),
            responses = {
                    @ApiResponse(responseCode = "200", description = "OK",
                            content = @Content(schema = @Schema(implementation = JwtAuthenticationResponse.class))),
                    @ApiResponse(responseCode = "401", description = "–ù–µ–≤–µ—Ä–Ω—ã–π –ª–æ–≥–∏–Ω/–ø–∞—Ä–æ–ª—å",
                            content = @Content(schema = @Schema(implementation = ApiError.class)))
            }
    )
    @PostMapping("/sign-in")
    public JwtAuthenticationResponse signIn(@RequestBody @Valid SignInRequest request) {
        return authenticationService.signIn(request);
    }

    /* ---------- demo endpoints ---------- */

    @Operation(
            summary = "Echo (–Ω—É–∂–Ω–∞ –ª—é–±–∞—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è)",
            security = @SecurityRequirement(name = "BearerAuth"),
            responses = @ApiResponse(responseCode = "200", description = "–ü—Ä–æ—Å—Ç–æ —Å—Ç—Ä–æ–∫–∞")
    )
    @GetMapping
    public String example() {
        return "Hello, world!";
    }

    @Operation(
            summary = "–¢–æ–ª—å–∫–æ –¥–ª—è ADMIN",
            security = @SecurityRequirement(name = "BearerAuth"),
            responses = {
                    @ApiResponse(responseCode = "200", description = "–í—ã ‚Äî –∞–¥–º–∏–Ω"),
                    @ApiResponse(responseCode = "403", description = "–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ø—Ä–∞–≤",
                            content = @Content(schema = @Schema(implementation = ApiError.class)))
            }
    )
    @PreAuthorize("hasRole('ADMIN')")
    @GetMapping("/admin")
    public String exampleAdmin() {
        return "Hello, admin!";
    }

    @Operation(
            summary   = "–í—ã–¥–∞—Ç—å —Ç–µ–∫—É—â–µ–º—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é —Ä–æ–ª—å ADMIN (–¥–µ–º–æ)",
            security  = @SecurityRequirement(name = "BearerAuth"),
            responses = @ApiResponse(responseCode = "200", description = "OK")
    )
    @GetMapping("/get-admin")
    public void getAdmin() {
        service.getAdmin();
    }
}
```

Contents of src/main/java/ru/gigastack/ai_reminder_back/exception/GlobalExceptionHandler.java:
```
package ru.gigastack.ai_reminder_back.exception;

import jakarta.servlet.http.HttpServletRequest;
import lombok.extern.slf4j.Slf4j;
import org.springframework.core.Ordered;
import org.springframework.core.annotation.Order;
import org.springframework.http.HttpStatus;
import org.springframework.http.ResponseEntity;
import org.springframework.security.core.AuthenticationException;
import org.springframework.validation.FieldError;
import org.springframework.web.bind.MethodArgumentNotValidException;
import org.springframework.web.bind.annotation.ExceptionHandler;
import org.springframework.web.bind.annotation.RestControllerAdvice;
import ru.gigastack.ai_reminder_back.common.ConflictException;
import ru.gigastack.ai_reminder_back.common.NotFoundException;

import java.time.OffsetDateTime;
import java.util.stream.Collectors;

/**
 * –ì–ª–æ–±–∞–ª—å–Ω—ã–π –ø–µ—Ä–µ—Ö–≤–∞—Ç –æ—à–∏–±–æ–∫ MVC + Spring Security.
 */
@Slf4j
@Order(Ordered.HIGHEST_PRECEDENCE)
@RestControllerAdvice
public class GlobalExceptionHandler {

    /* ---------- 400: –æ—à–∏–±–∫–∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ ---------- */

    @ExceptionHandler(MethodArgumentNotValidException.class)
    public ResponseEntity<ApiError> handleValidation(
            MethodArgumentNotValidException ex,
            HttpServletRequest req) {

        String msg = ex.getBindingResult()
                .getFieldErrors().stream()
                .map(this::fieldErrorToString)
                .collect(Collectors.joining("; "));

        return build(HttpStatus.BAD_REQUEST, msg, req, ex);
    }

    /* ---------- 401: –ø—Ä–æ–±–ª–µ–º—ã –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ ---------- */

    @ExceptionHandler(AuthenticationException.class)
    public ResponseEntity<ApiError> handleAuth(
            AuthenticationException ex,
            HttpServletRequest req) {

        return build(HttpStatus.UNAUTHORIZED, ex.getMessage(), req, ex);
    }

    /* ---------- 500: –≤—Å—ë –æ—Å—Ç–∞–ª—å–Ω–æ–µ ---------- */

    @ExceptionHandler(Exception.class)
    public ResponseEntity<ApiError> handleAll(
            Exception ex,
            HttpServletRequest req) {

        return build(HttpStatus.INTERNAL_SERVER_ERROR,
                "Internal error", req, ex);
    }
    @ExceptionHandler(NotFoundException.class)
    public ResponseEntity<ApiError> handleNotFound(
            NotFoundException ex, HttpServletRequest req) {

        return build(HttpStatus.NOT_FOUND, ex.getMessage(), req, ex);
    }

    /* ---------- util ---------- */

    private ResponseEntity<ApiError> build(HttpStatus status,
                                           String message,
                                           HttpServletRequest req,
                                           Exception ex) {

        ApiError body = ApiError.builder()
                .timestamp(OffsetDateTime.now())
                .status(status.value())
                .error(status.getReasonPhrase())
                .message(message)
                .path(req.getMethod() + " " + req.getRequestURI())
                .build();

        if (status.is5xxServerError()) {
            log.error("{} ‚Üí {} {}", body.getPath(), status.value(), message, ex);
        } else {
            log.warn("{} ‚Üí {} {}", body.getPath(), status.value(), message);
        }

        return ResponseEntity.status(status).body(body);
    }

    private String fieldErrorToString(FieldError e) {
        return "%s: %s".formatted(e.getField(), e.getDefaultMessage());
    }

    @ExceptionHandler(ConflictException.class)
    public ResponseEntity<ApiError> handleConflict(
            ConflictException ex, HttpServletRequest req) {
        return build(HttpStatus.CONFLICT, ex.getMessage(), req, ex);
    }
}

```

Contents of src/main/java/ru/gigastack/ai_reminder_back/exception/ApiError.java:
```
package ru.gigastack.ai_reminder_back.exception;

import io.swagger.v3.oas.annotations.media.Schema;
import lombok.Builder;
import lombok.Data;

import java.time.OffsetDateTime;

@Data
@Builder
@Schema(description = "–ï–¥–∏–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞ –ø—Ä–∏ –æ—à–∏–±–∫–µ")
public class ApiError {

    @Schema(description = "ISO-–¥–∞—Ç–∞/–≤—Ä–µ–º—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ", example = "2025-06-17T02:55:09.384+00:00")
    private OffsetDateTime timestamp;

    @Schema(description = "HTTP-–∫–æ–¥", example = "404")
    private int            status;

    @Schema(description = "–ö–æ—Ä–æ—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –∫–æ–¥–∞", example = "Not Found")
    private String         error;

    @Schema(description = "–î–µ—Ç–∞–ª–∏ –ø—Ä–∏—á–∏–Ω—ã", example = "Reminder not found")
    private String         message;

    @Schema(description = "–ó–∞–ø—Ä–æ—à–µ–Ω–Ω—ã–π –º–µ—Ç–æ–¥ –∏ –ø—É—Ç—å", example = "GET /api/v1/reminders/42")
    private String         path;
}
```

